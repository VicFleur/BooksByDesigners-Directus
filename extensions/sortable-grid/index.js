import{useApi as e,useStores as t,defineInterface as a}from"@directus/extensions-sdk";import{toRefs as n,ref as l,computed as r,watch as i,onMounted as o,onBeforeUnmount as s,resolveComponent as u,createElementBlock as d,openBlock as c,createElementVNode as v,createCommentVNode as f,createVNode as g,toDisplayString as p,createBlock as m,unref as _,withCtx as h,createTextVNode as y,withModifiers as b,normalizeStyle as x,Fragment as w,renderList as k,normalizeClass as S}from"vue";var C=[],A=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,r="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var i=C.indexOf(r);-1===i&&(i=C.push(r)-1,A[i]={}),a=A[i]&&A[i][n]?A[i][n]:A[i][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var i="prepend"===n?"afterbegin":"beforeend";return r.insertAdjacentElement(i,e),e}}("\n.sg[data-v-20690f4c] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n.sg__toolbar[data-v-20690f4c] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tgap: 12px;\n}\n.sg__toolbar-left[data-v-20690f4c] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__label[data-v-20690f4c] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n}\n.sg__count[data-v-20690f4c] {\n\tpadding: 2px 8px;\n\tborder-radius: 999px;\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n}\n.sg__toolbar-right[data-v-20690f4c] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n}\n.sg__notice[data-v-20690f4c] {\n\tpadding: 10px 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__grid[data-v-20690f4c] {\n\tdisplay: grid;\n\tgap: 12px;\n}\n.sg__card[data-v-20690f4c] {\n\tborder: 1px solid var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background);\n\tuser-select: none;\n\tcursor: grab;\n}\n.sg__card--select[data-v-20690f4c] {\n\tcursor: pointer;\n}\n.sg__card--selected[data-v-20690f4c] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__card--dragging[data-v-20690f4c] {\n\topacity: 0.6;\n}\n.sg__card--drag-over[data-v-20690f4c] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__cover[data-v-20690f4c] {\n\tposition: relative;\n\taspect-ratio: 1 / 1;\n\tbackground: var(--theme--background-subdued);\n}\n\n/* Fallback for browsers without `aspect-ratio` */\n@supports not (aspect-ratio: 1 / 1) {\n.sg__cover[data-v-20690f4c]::before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tpadding-top: 100%;\n}\n.sg__cover-img[data-v-20690f4c],\n\t.sg__cover-placeholder[data-v-20690f4c] {\n\t\tposition: absolute;\n\t\tinset: 0;\n}\n}\n.sg__cover-img[data-v-20690f4c] {\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n}\n.sg__cover-placeholder[data-v-20690f4c] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__card-actions[data-v-20690f4c] {\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 6px;\n}\n.sg__drag-handle[data-v-20690f4c] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 999px;\n\tbackground: color-mix(in srgb, var(--theme--background) 85%, transparent);\n\tborder: 1px solid var(--theme--border-color);\n\tcolor: var(--theme--foreground-subdued);\n\tcursor: grab;\n}\n.sg__card-body[data-v-20690f4c] {\n\tpadding: 10px 12px 12px;\n}\n.sg__title[data-v-20690f4c] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n\tline-height: 1.2;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.4em;\n}\n.sg__subtitle[data-v-20690f4c] {\n\tmargin-top: 4px;\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n\tline-height: 1.3;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.6em;\n}\n.sg__sentinel[data-v-20690f4c] {\n\theight: 1px;\n}\n.sg__empty[data-v-20690f4c] {\n\tgrid-column: 1 / -1;\n\tpadding: 28px 12px;\n\ttext-align: center;\n\tborder: 1px dashed var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__empty-title[data-v-20690f4c] {\n\tfont-weight: 600;\n\tmargin-bottom: 10px;\n\tcolor: var(--theme--foreground);\n}\n.sg__empty-actions[data-v-20690f4c] {\n\tdisplay: inline-flex;\n\tgap: 8px;\n}\n.sg__drawer-grid[data-v-20690f4c] {\n\tpadding: 0 16px 100px 16px;\n\tdisplay: grid;\n\tgap: 12px;\n\tgrid-template-columns: repeat(3, minmax(0, 1fr));\n\talign-content: start;\n}\n.sg__drawer-form[data-v-20690f4c] {\n\theight: 100%;\n\toverflow: auto;\n\tpadding: 16px;\n}\n.sg__drawer-state[data-v-20690f4c] {\n\tgrid-column: 1 / -1;\n\tpadding: 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__drawer-actions[data-v-20690f4c] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__drawer-search[data-v-20690f4c] {\n\tflex: 1 1 auto;\n\tmin-width: 220px;\n}\n@media (max-width: 600px) {\n.sg__drawer-grid[data-v-20690f4c] {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr));\n}\n.sg__drawer-search[data-v-20690f4c] {\n\t\tmin-width: 0;\n}\n}\n",{});var N=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a};const M={class:"sg"},j={class:"sg__toolbar"},D={class:"sg__toolbar-left"},$={key:0,class:"sg__count"},E={class:"sg__toolbar-right"},T={key:0,class:"sg__notice"},O={key:1,class:"sg__notice"},I={key:2,class:"sg__notice"},B={key:3,class:"sg__notice"},z=["draggable","onDragstart","onDragover","onDrop"],q={class:"sg__cover"},F=["src"],U={key:1,class:"sg__cover-placeholder"},V={class:"sg__card-actions"},L={class:"sg__drag-handle",title:"Drag to reorder"},G={class:"sg__card-body"},K={class:"sg__title"},R={class:"sg__subtitle"},H={key:0,class:"sg__empty"},J={class:"sg__empty-actions"},P=["onClick"],Q={class:"sg__cover"},W=["src"],X={key:1,class:"sg__cover-placeholder"},Y={class:"sg__card-body"},Z={class:"sg__title"},ee={class:"sg__subtitle"},te={key:0,class:"sg__drawer-state"},ae={key:1,class:"sg__drawer-state"},ne={key:2,class:"sg__drawer-state"},le={class:"sg__drawer-actions"},re={key:0,class:"sg__drawer-state"},ie={key:1,class:"sg__drawer-form"},oe={__name:"interface",props:{value:{type:Array,default:()=>[]},primaryKey:{type:String,default:"id"},collection:{type:String,required:!0},field:{type:String,required:!0},width:{type:String,default:"full"},disabled:{type:Boolean,default:!1},layout:{type:String,default:"grid"},tableSpacing:{type:String,default:"cozy"},version:{type:String,default:"1.0.0"},fields:{type:Array,default:()=>["id"]},template:{type:String,default:null},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0},filter:{type:Object,default:()=>null},enableSearchFilter:{type:Boolean,default:!1},enableLink:{type:Boolean,default:!0},limit:{type:Number,default:1e3},sort:{type:String,default:"id"},sortDirection:{type:String,default:"asc"}},emits:["input"],setup(a,{emit:C}){const A=a,N=C,oe=e(),{collection:se,field:ue,primaryKey:de,disabled:ce,enableCreate:ve,enableSelect:fe}=n(A),{useFieldsStore:ge}=t(),pe=ge(),me=l("id"),_e=r(()=>pe.getField(se.value,ue.value)?.meta||{}),he=r(()=>_e.value?.options??{});function ye(e){if(!e)return null;if("string"!=typeof e)return null;let t=e.trim();if(!t)return null;const a=t.match(/^\{\{\s*([^}]+?)\s*\}\}$/);return a&&(t=a[1].trim()),t=t.replace(/\s*>\s*/g,"."),t=t.replace(/\s*\.\s*/g,".").replace(/\s+/g,""),t=t.replace(/^\.+/,"").replace(/\.+$/,""),t||null}const be=r(()=>ye(he.value.card_cover)),xe=r(()=>ye(he.value.card_title)),we=r(()=>ye(he.value.card_subtitle_key)),ke=r(()=>Number(he.value.columns||6)),Se=r(()=>Number(he.value.limit||1e3));function Ce(e){return String(e)}function Ae(e,t){if(!e||!t)return null;if("string"!=typeof t)return null;const a=t.split(".").filter(Boolean);let n=e;for(const e of a){if(null==n)return null;n=n[e]}return n??null}function Ne(e){return null==e?null:"object"==typeof e?e[me.value]??e.id??null:e}const Me=l(Array.isArray(A.value)?A.value:[]);i(()=>A.value,e=>{Me.value=Array.isArray(e)?e:[]},{deep:!0});const je=r(()=>{const e=Me.value;if(!Array.isArray(e))return[];const t=new Set,a=[];for(const n of e){const e=Ne(n);if(null==e)continue;const l=Ce(e);t.has(l)||(t.add(l),a.push(e))}return a}),De=r(()=>[...je.value].reverse()),$e=r(()=>new Set(je.value.map(Ce))),Ee=r(()=>({gridTemplateColumns:`repeat(${Math.max(1,ke.value||6)}, minmax(0, 1fr))`})),Te=l(null),Oe=l(!1),Ie=l(null),Be=r(()=>Te.value?.collection??null),ze=r(()=>Te.value?.field??null),qe=r(()=>Te.value?.sort_field??Te.value?.meta?.sort_field??null),Fe=r(()=>ye(he.value.sort_field)),Ue=r(()=>Fe.value||qe.value||null);i(Be,()=>{!async function(){if(Be.value)try{const e=await oe.get(`/fields/${Be.value}`,{params:{limit:-1}}),t=e?.data?.data??[],a=t.find(e=>e?.schema?.is_primary_key)?.field;me.value=a||"id"}catch{me.value="id"}else me.value="id"}()},{immediate:!0}),i([se,ue],()=>{!async function(){Ie.value=null,Oe.value=!0,Te.value=null;try{const e=await oe.get("/relations",{params:{filter:{related_collection:{_eq:se.value},meta:{one_field:{_eq:ue.value}}},limit:1}});Te.value=e?.data?.data?.[0]??null}catch(e){Ie.value=e,Te.value=null}finally{Oe.value=!1}}()},{immediate:!0});const Ve=l(new Map),Le=l(new Set);i(()=>Me.value,e=>{if(Array.isArray(e))for(const t of e)if(t&&"object"==typeof t){const e=Ne(t);if(null==e)continue;Ve.value.set(Ce(e),t)}},{deep:!0,immediate:!0});const Ge=r(()=>{const e=new Set([me.value]),t=be.value,a=xe.value,n=we.value;return t&&e.add(t),a&&e.add(a),n&&e.add(n),Array.from(e)}),Ke=l(0);i(()=>je.value.length,(e,t)=>{const a="number"==typeof t?t:0;0!==Ke.value?e>a&&Ke.value>=a?Ke.value=e:Ke.value=Math.min(Ke.value,e):Ke.value=Math.min(e,Math.max(1,Se.value||1e3))},{immediate:!0});const Re=r(()=>De.value.slice(0,Ke.value));function He(e){if(!e)return!1;const t=Ge.value;for(const a of t){if(!(a.split(".")[0]in e))return!1}return!0}async function Je(){if(!Be.value)return;const e=[];for(const t of Re.value){const a=Ce(t);if(Le.value.has(a))continue;const n=Ve.value.get(a);n&&He(n)||(Le.value.add(a),e.push(t))}e.length&&await async function(e){if(!Be.value)return;if(!e.length)return;const t=me.value,a=Ge.value;for(let n=0;n<e.length;n+=100){const l=e.slice(n,n+100);try{const e=await oe.get(`/items/${Be.value}`,{params:{fields:a,filter:{[t]:{_in:l}},limit:-1}}),n=e?.data?.data??[];for(const e of n){const a=e?.[t]??e?.id;null!=a&&Ve.value.set(Ce(a),e)}}catch{}finally{for(const e of l)Le.value.delete(Ce(e))}}}(e)}i([Re,Ge,Be],()=>{Je()},{immediate:!0});const Pe=l(null);let Qe=null;function We(e){return Ve.value.get(Ce(e))??null}function Xe(e){return(Ae(We(e),xe.value)??"—")+""}function Ye(e){const t=Ae(We(e),we.value);return null==t?"":String(t)}function Ze(e){return null==e?null:"string"==typeof e||"number"==typeof e?e:"object"==typeof e?e.id??e[me.value]??null:null}function et(e){return e?`/assets/${encodeURIComponent(String(e))}?fit=cover&width=600&height=600&quality=80`:null}function tt(e){const t=We(e);if(!t||!be.value)return null;const a=Ae(t,be.value);if(a&&"object"==typeof a&&"string"==typeof a.$thumbnail)return a.$thumbnail;return et(Ze(a))}function at(e){if(!e||!be.value)return null;const t=Ae(e,be.value);if(t&&"object"==typeof t&&"string"==typeof t.$thumbnail)return t.$thumbnail;return et(Ze(t))}o(()=>{Qe=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&function(){const e=je.value.length;Ke.value>=e||(Ke.value=Math.min(e,Ke.value+Math.max(1,Se.value||1e3)))}()},{root:null,rootMargin:"300px",threshold:.01}),Pe.value&&Qe.observe(Pe.value)}),i(Pe,(e,t)=>{Qe&&(t&&Qe.unobserve(t),e&&Qe.observe(e))},{flush:"post"}),s(()=>{Qe&&Qe.disconnect()});const nt=r(()=>{const e=Me.value;return!(!Array.isArray(e)||0===e.length)&&"object"==typeof e[0]});function lt(e){const t=function(e){const t=Ue.value;if(!nt.value&&!t)return e;const a=new Map;for(const e of Me.value){const t=Ne(e);null!=t&&a.set(Ce(t),e)}return e.map((e,n)=>{const l=a.get(Ce(e)),r=l&&"object"==typeof l?{...l}:{[me.value]:e};return t&&(r[t]=n),r})}(e);Me.value=t,N("input",t)}function rt(e){lt([...e].reverse())}const it=l(null),ot=l(null);function st(){it.value=null,ot.value=null}function ut(e){if(!it.value)return;const t=Ce(e);t!==it.value&&function(e,t){const a=[...De.value],n=a.findIndex(t=>Ce(t)===e),l=a.findIndex(e=>Ce(e)===t);if(-1===n||-1===l||n===l)return;const[r]=a.splice(n,1);a.splice(l,0,r),rt(a)}(it.value,t),st()}function dt(){}function ct(){if(!it.value)return;const e=[...De.value],t=e.findIndex(e=>Ce(e)===it.value);if(-1===t)return st();const[a]=e.splice(t,1);e.push(a),rt(e),st()}const vt=l(!1),ft=l(""),gt=l([]),pt=l(!1),mt=l(!1),_t=l(new Map),ht=l(!0),yt=l(null),bt=l(null);let xt=null;const wt=r(()=>{const e=me.value;return gt.value.filter(t=>!$e.value.has(Ce(t?.[e]??t?.id)))});async function kt(){if(Be.value&&ht.value&&!pt.value){pt.value=!0,mt.value=!1;try{me.value;const e=await oe.get(`/items/${Be.value}`,{params:{fields:Ge.value,limit:-1,search:ft.value||void 0,filter:A.filter||void 0}}),t=e?.data?.data??[];gt.value=t,ht.value=!1}catch{mt.value=!0,ht.value=!1}finally{pt.value=!1}}}function St(){xt&&xt.disconnect(),xt=null}function Ct(e){vt.value=!!e,vt.value?(_t.value=new Map,gt.value=[],ht.value=!0,mt.value=!1,kt()):(St(),_t.value=new Map)}function At(){Ct(!1)}function Nt(){Ct(!0)}function Mt(){const e=je.value,t=new Set(e.map(Ce)),a=[];for(const[e,n]of _t.value.entries())t.has(e)||a.push(n);lt([...e,...a]),Ct(!1)}i([vt,yt,bt],()=>(St(),void(vt.value&&yt.value&&bt.value&&(xt=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&kt()},{root:yt.value,rootMargin:"300px",threshold:.01}),xt.observe(bt.value)))),{flush:"post"}),s(()=>{St()});const jt=l(!1),Dt=l({}),$t=l(!1),Et=r(()=>{try{if(null!=de.value&&"+"!==de.value&&"id"!==de.value)return de.value;const e=(window.location.pathname||"").split("/").filter(Boolean),t=e.indexOf("content");return-1!==t&&e.length>=t+3?e[t+2]:null}catch{return null}}),Tt=r(()=>{const e={};return ze.value&&Et.value&&"+"!==Et.value&&(e[ze.value]=Et.value),e});function Ot(){It(!0),Dt.value={}}function It(e){jt.value=!!e,jt.value?Dt.value={}:(Dt.value={},$t.value=!1)}function Bt(){It(!1)}async function zt(){if(Be.value){$t.value=!0;try{const e=await oe.post(`/items/${Be.value}`,Dt.value,{params:{fields:[me.value]}}),t=e?.data?.data??null,a=t?.[me.value]??t?.id??null;null!=a&&lt([...je.value,a]),It(!1)}catch{}finally{$t.value=!1}}}return(e,t)=>{const a=u("v-button"),n=u("v-icon"),l=u("v-drawer"),r=u("v-form");return c(),d("div",M,[v("div",j,[v("div",D,[f(' <div class="sg__label">Related</div> '),je.value.length?(c(),d("div",$,p(je.value.length),1)):f("v-if",!0)]),v("div",E,[_(fe)?(c(),m(a,{key:0,secondary:"",disabled:_(ce)||!Be.value,onClick:Nt},{default:h(()=>[...t[1]||(t[1]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),_(ve)?(c(),m(a,{key:1,disabled:_(ce)||!Be.value,onClick:Ot},{default:h(()=>[...t[2]||(t[2]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])]),Ie.value?(c(),d("div",T," Unable to resolve relation metadata for this O2M field. The grid can still render existing values, but “Add Existing” / “Create New” may not work. ")):Oe.value?(c(),d("div",O,"Loading relation…")):Be.value?f("v-if",!0):(c(),d("div",I," No related collection detected for this O2M field. ")),Ue.value?f("v-if",!0):(c(),d("div",B," This relationship has no manual sort field configured. Drag reordering might not persist server-side until a sort field is set in the relationship settings. ")),v("div",{class:"sg__grid",style:x(Ee.value),onDragover:b(dt,["prevent"]),onDrop:b(ct,["prevent"])},[(c(!0),d(w,null,k(Re.value,e=>(c(),d("div",{key:Ce(e),class:S(["sg__card",{"sg__card--dragging":it.value===Ce(e),"sg__card--drag-over":ot.value===Ce(e)}]),draggable:!_(ce),onDragstart:t=>function(e,t){ce.value||(it.value=Ce(e),ot.value=null,t?.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",it.value)))}(e,t),onDragend:st,onDragover:b(t=>function(e){if(!it.value)return;const t=Ce(e);t!==it.value&&(ot.value=t)}(e),["prevent"]),onDrop:b(t=>ut(e),["prevent"])},[v("div",q,[tt(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:tt(e),alt:""},null,8,F)):(c(),d("div",U,[g(n,{name:"image"})])),v("div",V,[g(a,{icon:"",small:"",secondary:"",class:"sg__icon-btn",disabled:_(ce),onClick:b(t=>function(e){const t=Ce(e);lt(je.value.filter(e=>Ce(e)!==t))}(e),["stop"])},{default:h(()=>[g(n,{name:"close"})]),_:1},8,["disabled","onClick"]),v("div",L,[g(n,{name:"drag_indicator"})])])]),v("div",G,[v("div",K,p(Xe(e)),1),v("div",R,p(Ye(e)),1)])],42,z))),128)),0===je.value.length?(c(),d("div",H,[t[5]||(t[5]=v("div",{class:"sg__empty-title"},"No related items",-1)),v("div",J,[_(fe)?(c(),m(a,{key:0,small:"",secondary:"",disabled:_(ce)||!Be.value,onClick:Nt},{default:h(()=>[...t[3]||(t[3]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),_(ve)?(c(),m(a,{key:1,small:"",disabled:_(ce)||!Be.value,onClick:Ot},{default:h(()=>[...t[4]||(t[4]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])])):f("v-if",!0),v("div",{ref_key:"sentinelEl",ref:Pe,class:"sg__sentinel"},null,512)],36),f(" Select Existing "),g(l,{title:"Add Existing","model-value":vt.value,"onUpdate:modelValue":Ct,onCancel:At},{actions:h(()=>[v("div",le,[f(' <div class="sg__drawer-search">\n\t\t\t\t\t\t<v-input small v-model="selectSearch" placeholder="Search…" @update:modelValue="onSelectSearchChange" />\n\t\t\t\t\t</div> '),g(a,{disabled:0===_t.value.size,onClick:Mt},{default:h(()=>[y(" Add "+p(_t.value.size),1)]),_:1},8,["disabled"])])]),default:h(()=>[v("div",{ref_key:"selectGridEl",ref:yt,class:"sg__drawer-grid"},[(c(!0),d(w,null,k(wt.value,e=>(c(),d("div",{key:Ce(e[me.value]),class:S(["sg__card sg__card--select",{"sg__card--selected":_t.value.has(Ce(e[me.value]))}]),onClick:t=>function(e){const t=Ce(e),a=new Map(_t.value);a.has(t)?a.delete(t):a.set(t,e),_t.value=a}(e[me.value])},[v("div",Q,[at(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:at(e),alt:""},null,8,W)):(c(),d("div",X,[g(n,{name:"image"})]))]),v("div",Y,[v("div",Z,p(Ae(e,xe.value)??"—"),1),v("div",ee,p(Ae(e,we.value)??""),1)])],10,P))),128)),mt.value?(c(),d("div",te,"Failed to load items.")):pt.value&&0===wt.value.length?(c(),d("div",ae,"Loading…")):pt.value||0!==wt.value.length?f("v-if",!0):(c(),d("div",ne,"No items available.")),v("div",{ref_key:"selectSentinelEl",ref:bt,class:"sg__sentinel"},null,512)],512)]),_:1},8,["model-value"]),f(" Create New "),g(l,{title:"Create New","model-value":jt.value,"onUpdate:modelValue":It,onCancel:Bt},{actions:h(()=>[g(a,{disabled:$t.value||!Be.value,onClick:zt},{default:h(()=>[y(p($t.value?"Creating…":"Create"),1)]),_:1},8,["disabled"])]),default:h(()=>[Be.value?(c(),d("div",ie,[g(r,{collection:Be.value,modelValue:Dt.value,"onUpdate:modelValue":t[0]||(t[0]=e=>Dt.value=e),"initial-values":Tt.value},null,8,["collection","modelValue","initial-values"])])):(c(),d("div",re,"No related collection available."))]),_:1},8,["model-value"])])}}};var se=a({id:"sortable-grid",name:"Sortable Grid",icon:"grid_view",description:"Edit a one-to-many relation using a grid of related items.",types:["alias"],localTypes:["o2m"],group:"relational",relational:!0,component:N(oe,[["__scopeId","data-v-20690f4c"]]),recommendedDisplays:["related-values"],options:({relations:e,field:{meta:t}})=>{const a=e.o2m?.collection;return[{field:"card_cover",name:"Card Cover",type:"string",meta:{width:"full",interface:"system-field",options:{collectionName:a}}},{field:"card_title",name:"Card Title",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"card_subtitle_key",name:"Card Subtitle",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"columns",name:"Columns",type:"integer",schema:{default_value:6,min:1,max:12},meta:{width:"half",interface:"input"}},{field:"limit",name:"$t:per_page",type:"integer",schema:{default_value:1e3},meta:{width:"half",interface:"input"}},{field:"sort_field",name:"Sort Field",type:"string",meta:{width:"full",interface:"system-field",note:"Optional override. Used when the relationship sort field cannot be detected automatically.",options:{collectionName:a}}}]}});export{se as default};
