import{useApi as e,useStores as t,defineInterface as a}from"@directus/extensions-sdk";import{toRefs as n,ref as l,computed as i,watch as r,onMounted as o,onBeforeUnmount as s,resolveComponent as u,createElementBlock as d,openBlock as c,createElementVNode as v,createCommentVNode as f,createVNode as g,toDisplayString as p,createBlock as m,unref as _,withCtx as h,createTextVNode as y,withModifiers as b,normalizeStyle as x,Fragment as w,renderList as k,normalizeClass as S}from"vue";var C=[],A=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var r=C.indexOf(i);-1===r&&(r=C.push(i)-1,A[r]={}),a=A[r]&&A[r][n]?A[r][n]:A[r][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var r="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(r,e),e}}("\n.sg[data-v-687375e2] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n.sg__toolbar[data-v-687375e2] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tgap: 12px;\n}\n.sg__toolbar-left[data-v-687375e2] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__label[data-v-687375e2] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n}\n.sg__count[data-v-687375e2] {\n\tpadding: 2px 8px;\n\tborder-radius: 999px;\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n}\n.sg__toolbar-right[data-v-687375e2] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n}\n.sg__notice[data-v-687375e2] {\n\tpadding: 10px 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__grid[data-v-687375e2] {\n\tdisplay: grid;\n\tgap: 12px;\n}\n.sg__card[data-v-687375e2] {\n\tborder: 1px solid var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background);\n\tuser-select: none;\n\tcursor: grab;\n}\n.sg__card--select[data-v-687375e2] {\n\tcursor: pointer;\n}\n.sg__card--selected[data-v-687375e2] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__card--dragging[data-v-687375e2] {\n\topacity: 0.6;\n}\n.sg__card--drag-over[data-v-687375e2] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__cover[data-v-687375e2] {\n\tposition: relative;\n\taspect-ratio: 1 / 1;\n\tbackground: var(--theme--background-subdued);\n}\n\n/* Fallback for browsers without `aspect-ratio` */\n@supports not (aspect-ratio: 1 / 1) {\n.sg__cover[data-v-687375e2]::before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tpadding-top: 100%;\n}\n.sg__cover-img[data-v-687375e2],\n\t.sg__cover-placeholder[data-v-687375e2] {\n\t\tposition: absolute;\n\t\tinset: 0;\n}\n}\n.sg__cover-img[data-v-687375e2] {\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n}\n.sg__cover-placeholder[data-v-687375e2] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__card-actions[data-v-687375e2] {\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 6px;\n}\n.sg__drag-handle[data-v-687375e2] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 999px;\n\tbackground: color-mix(in srgb, var(--theme--background) 85%, transparent);\n\tborder: 1px solid var(--theme--border-color);\n\tcolor: var(--theme--foreground-subdued);\n\tcursor: grab;\n}\n.sg__card-body[data-v-687375e2] {\n\tpadding: 10px 12px 12px;\n}\n.sg__title[data-v-687375e2] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n\tline-height: 1.2;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.4em;\n}\n.sg__subtitle[data-v-687375e2] {\n\tmargin-top: 4px;\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n\tline-height: 1.3;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.6em;\n}\n.sg__sentinel[data-v-687375e2] {\n\theight: 1px;\n}\n.sg__empty[data-v-687375e2] {\n\tgrid-column: 1 / -1;\n\tpadding: 28px 12px;\n\ttext-align: center;\n\tborder: 1px dashed var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__empty-title[data-v-687375e2] {\n\tfont-weight: 600;\n\tmargin-bottom: 10px;\n\tcolor: var(--theme--foreground);\n}\n.sg__empty-actions[data-v-687375e2] {\n\tdisplay: inline-flex;\n\tgap: 8px;\n}\n.sg__drawer-grid[data-v-687375e2] {\n\tpadding: 0 16px 100px 16px;\n\tdisplay: grid;\n\tgap: 12px;\n\tgrid-template-columns: repeat(3, minmax(0, 1fr));\n\talign-content: start;\n}\n.sg__drawer-form[data-v-687375e2] {\n\theight: 100%;\n\toverflow: auto;\n\tpadding: 16px;\n}\n.sg__drawer-state[data-v-687375e2] {\n\tgrid-column: 1 / -1;\n\tpadding: 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__drawer-actions[data-v-687375e2] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__drawer-search[data-v-687375e2] {\n\tflex: 1 1 auto;\n\tmin-width: 220px;\n}\n@media (max-width: 600px) {\n.sg__drawer-grid[data-v-687375e2] {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr));\n}\n.sg__drawer-search[data-v-687375e2] {\n\t\tmin-width: 0;\n}\n}\n",{});var M=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a};const N={class:"sg"},j={class:"sg__toolbar"},D={class:"sg__toolbar-left"},$={key:0,class:"sg__count"},E={class:"sg__toolbar-right"},T={key:0,class:"sg__notice"},I={key:1,class:"sg__notice"},O={key:2,class:"sg__notice"},q={key:3,class:"sg__notice"},B=["draggable","onDragstart","onDragover","onDrop"],F={class:"sg__cover"},z=["src"],U={key:1,class:"sg__cover-placeholder"},V={class:"sg__card-actions"},K={class:"sg__drag-handle",title:"Drag to reorder"},L={class:"sg__card-body"},R={class:"sg__title"},G={class:"sg__subtitle"},H={key:0,class:"sg__empty"},J={class:"sg__empty-actions"},P=["onClick"],Q={class:"sg__cover"},W=["src"],X={key:1,class:"sg__cover-placeholder"},Y={class:"sg__card-body"},Z={class:"sg__title"},ee={class:"sg__subtitle"},te={key:0,class:"sg__drawer-state"},ae={key:1,class:"sg__drawer-state"},ne={key:2,class:"sg__drawer-state"},le={class:"sg__drawer-actions"},ie={key:0,class:"sg__drawer-state"},re={key:1,class:"sg__drawer-form"},oe={__name:"interface",props:{value:{type:Array,default:()=>[]},primaryKey:{type:String,default:"id"},collection:{type:String,required:!0},field:{type:String,required:!0},width:{type:String,default:"full"},disabled:{type:Boolean,default:!1},layout:{type:String,default:"grid"},tableSpacing:{type:String,default:"cozy"},version:{type:String,default:"1.0.0"},fields:{type:Array,default:()=>["id"]},template:{type:String,default:null},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0},filter:{type:Object,default:()=>null},enableSearchFilter:{type:Boolean,default:!1},enableLink:{type:Boolean,default:!0},limit:{type:Number,default:1e3},sort:{type:String,default:"id"},sortDirection:{type:String,default:"asc"}},emits:["input"],setup(a,{emit:C}){const A=a,M=C,oe=e(),{collection:se,field:ue,primaryKey:de,disabled:ce,enableCreate:ve,enableSelect:fe}=n(A),{useFieldsStore:ge}=t(),pe=ge(),me=l("id"),_e=i(()=>pe.getField(se.value,ue.value)?.meta||{}),he=i(()=>_e.value?.options??{});function ye(e){if(!e)return null;if("string"!=typeof e)return null;let t=e.trim();if(!t)return null;const a=t.match(/^\{\{\s*([^}]+?)\s*\}\}$/);return a&&(t=a[1].trim()),t=t.replace(/\s*>\s*/g,"."),t=t.replace(/\s*\.\s*/g,".").replace(/\s+/g,""),t=t.replace(/^\.+/,"").replace(/\.+$/,""),t||null}const be=i(()=>ye(he.value.card_cover)),xe=i(()=>ye(he.value.card_title)),we=i(()=>ye(he.value.card_subtitle_key)),ke=i(()=>Number(he.value.columns||6)),Se=i(()=>Number(he.value.limit||1e3)),Ce=i(()=>he.value.related_collection),Ae=i(()=>he.value.foreign_key);function Me(e){return String(e)}function Ne(e,t){if(!e||!t)return null;if("string"!=typeof t)return null;const a=t.split(".").filter(Boolean);let n=e;for(const e of a){if(null==n)return null;n=n[e]}return n??null}function je(e){return null==e?null:"object"==typeof e?e[me.value]??e.id??null:e}const De=l(Array.isArray(A.value)?A.value:[]),$e=l(null),Ee=l(!1);r(()=>A.value,e=>{De.value=Array.isArray(e)?e:[],Ee.value||($e.value=null)},{deep:!0});const Te=i(()=>{if($e.value)return $e.value;const e=De.value;if(!Array.isArray(e))return[];const t=new Set,a=[];for(const n of e){const e=je(n);if(null==e)continue;const l=Me(e);t.has(l)||(t.add(l),a.push(e))}return a}),Ie=i(()=>[...Te.value].reverse()),Oe=i(()=>new Set(Te.value.map(Me))),qe=i(()=>({gridTemplateColumns:`repeat(${Math.max(1,ke.value||6)}, minmax(0, 1fr))`})),Be=l(null),Fe=l(!1),ze=l(null),Ue=i(()=>Ce.value||Be.value?.collection||Be.value?.many_collection||null),Ve=i(()=>Ae.value||Be.value?.field||Be.value?.many_field||null),Ke=i(()=>Be.value?.sort_field??Be.value?.meta?.sort_field??null),Le=i(()=>ye(he.value.sort_field)),Re=i(()=>Le.value||Ke.value||null);function Ge(){if(null!=de.value&&"+"!==de.value&&"id"!==de.value)return de.value;try{const e=(window.location.pathname||"").split("/").filter(Boolean),t=e.indexOf("content");if(-1!==t&&e.length>=t+3)return e[t+2]}catch{}return null}r(Ue,()=>{!async function(){if(Ue.value)try{const e=await oe.get(`/fields/${Ue.value}`,{params:{limit:-1}}),t=e?.data?.data??[],a=t.find(e=>e?.schema?.is_primary_key)?.field;me.value=a||"id"}catch{me.value="id"}else me.value="id"}()},{immediate:!0}),r([se,ue],()=>{!async function(){ze.value=null,Fe.value=!0,Be.value=null;try{const e=await oe.get("/relations",{params:{filter:{related_collection:{_eq:se.value},meta:{one_field:{_eq:ue.value}}},limit:1}});Be.value=e?.data?.data?.[0]??null}catch(e){ze.value=e,Be.value=null}finally{Fe.value=!1}}()},{immediate:!0}),r([Ue,Ve,de],()=>{Ee.value=!1,$e.value=null,async function(){if(!Ue.value||!Ve.value)return;if(Ee.value)return;const e=Array.isArray(A.value)?A.value.length:0;if(console.log("relationInfo",Be.value),100!==e)return;const t=Ge();if(t)try{const e=me.value,a=Re.value,n=await oe.get(`/items/${Ue.value}`,{params:{fields:[e],filter:{[Ve.value]:{_eq:t}},sort:a?[a]:void 0,limit:-1}});console.log({params:{fields:[e],filter:{[Ve.value]:{_eq:t}},sort:a?[a]:void 0,limit:-1}});const l=(n?.data?.data??[]).map(t=>t[e]).filter(e=>null!=e);l.length>0&&($e.value=l)}catch{}finally{Ee.value=!0}}()},{immediate:!0});const He=l(new Map),Je=l(new Set);r(()=>De.value,e=>{if(Array.isArray(e))for(const t of e)if(t&&"object"==typeof t){const e=je(t);if(null==e)continue;He.value.set(Me(e),t)}},{deep:!0,immediate:!0});const Pe=i(()=>{const e=new Set([me.value]),t=be.value,a=xe.value,n=we.value;return t&&e.add(t),a&&e.add(a),n&&e.add(n),Array.from(e)}),Qe=l(0);r(()=>Te.value.length,(e,t)=>{const a="number"==typeof t?t:0;0!==Qe.value?e>a&&Qe.value>=a?Qe.value=e:Qe.value=Math.min(Qe.value,e):Qe.value=Math.min(e,Math.max(1,Se.value||1e3))},{immediate:!0});const We=i(()=>Ie.value.slice(0,Qe.value));function Xe(e){if(!e)return!1;const t=Pe.value;for(const a of t){if(!(a.split(".")[0]in e))return!1}return!0}async function Ye(){if(!Ue.value)return;const e=[];for(const t of We.value){const a=Me(t);if(Je.value.has(a))continue;const n=He.value.get(a);n&&Xe(n)||(Je.value.add(a),e.push(t))}e.length&&await async function(e){if(!Ue.value)return;if(!e.length)return;const t=me.value,a=Pe.value;for(let n=0;n<e.length;n+=100){const l=e.slice(n,n+100);try{const e=await oe.get(`/items/${Ue.value}`,{params:{fields:a,filter:{[t]:{_in:l}},limit:-1}}),n=e?.data?.data??[];for(const e of n){const a=e?.[t]??e?.id;null!=a&&He.value.set(Me(a),e)}}catch{}finally{for(const e of l)Je.value.delete(Me(e))}}}(e)}r([We,Pe,Ue],()=>{Ye()},{immediate:!0});const Ze=l(null);let et=null;function tt(e){return He.value.get(Me(e))??null}function at(e){return(Ne(tt(e),xe.value)??"—")+""}function nt(e){const t=Ne(tt(e),we.value);return null==t?"":String(t)}function lt(e){return null==e?null:"string"==typeof e||"number"==typeof e?e:"object"==typeof e?e.id??e[me.value]??null:null}function it(e){return e?`/assets/${encodeURIComponent(String(e))}?fit=cover&width=600&height=600&quality=80`:null}function rt(e){const t=tt(e);if(!t||!be.value)return null;const a=Ne(t,be.value);if(a&&"object"==typeof a&&"string"==typeof a.$thumbnail)return a.$thumbnail;return it(lt(a))}function ot(e){if(!e||!be.value)return null;const t=Ne(e,be.value);if(t&&"object"==typeof t&&"string"==typeof t.$thumbnail)return t.$thumbnail;return it(lt(t))}o(()=>{et=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&function(){const e=Te.value.length;Qe.value>=e||(Qe.value=Math.min(e,Qe.value+Math.max(1,Se.value||1e3)))}()},{root:null,rootMargin:"300px",threshold:.01}),Ze.value&&et.observe(Ze.value)}),r(Ze,(e,t)=>{et&&(t&&et.unobserve(t),e&&et.observe(e))},{flush:"post"}),s(()=>{et&&et.disconnect()});const st=i(()=>{const e=De.value;return!(!Array.isArray(e)||0===e.length)&&"object"==typeof e[0]});function ut(e){const t=function(e){const t=Re.value;if(!st.value&&!t)return e;const a=new Map;for(const e of De.value){const t=je(e);null!=t&&a.set(Me(t),e)}return e.map((e,n)=>{const l=a.get(Me(e)),i=l&&"object"==typeof l?{...l}:{[me.value]:e};return t&&(i[t]=n),i})}(e);De.value=t,$e.value=e,M("input",t)}function dt(e){ut([...e].reverse())}function ct(){if(Te.value.length<2)return;const e=[...Te.value];for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}ut(e)}const vt=l(null),ft=l(null);function gt(){vt.value=null,ft.value=null}function pt(e){if(!vt.value)return;const t=Me(e);t!==vt.value&&function(e,t){const a=[...Ie.value],n=a.findIndex(t=>Me(t)===e),l=a.findIndex(e=>Me(e)===t);if(-1===n||-1===l||n===l)return;const[i]=a.splice(n,1);a.splice(l,0,i),dt(a)}(vt.value,t),gt()}function mt(){}function _t(){if(!vt.value)return;const e=[...Ie.value],t=e.findIndex(e=>Me(e)===vt.value);if(-1===t)return gt();const[a]=e.splice(t,1);e.push(a),dt(e),gt()}const ht=l(!1),yt=l(""),bt=l([]),xt=l(!1),wt=l(!1),kt=l(new Map),St=l(!0),Ct=l(null),At=l(null);let Mt=null;const Nt=i(()=>{const e=me.value;return bt.value.filter(t=>!Oe.value.has(Me(t?.[e]??t?.id)))});async function jt(){if(Ue.value&&St.value&&!xt.value){xt.value=!0,wt.value=!1;try{me.value;const e=await oe.get(`/items/${Ue.value}`,{params:{fields:Pe.value,limit:-1,search:yt.value||void 0,filter:A.filter||void 0}}),t=e?.data?.data??[];bt.value=t,St.value=!1}catch{wt.value=!0,St.value=!1}finally{xt.value=!1}}}function Dt(){Mt&&Mt.disconnect(),Mt=null}function $t(e){ht.value=!!e,ht.value?(kt.value=new Map,bt.value=[],St.value=!0,wt.value=!1,jt()):(Dt(),kt.value=new Map)}function Et(){$t(!1)}function Tt(){$t(!0)}function It(){const e=Te.value,t=new Set(e.map(Me)),a=[];for(const[e,n]of kt.value.entries())t.has(e)||a.push(n);ut([...e,...a]),$t(!1)}r([ht,Ct,At],()=>(Dt(),void(ht.value&&Ct.value&&At.value&&(Mt=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&jt()},{root:Ct.value,rootMargin:"300px",threshold:.01}),Mt.observe(At.value)))),{flush:"post"}),s(()=>{Dt()});const Ot=l(!1),qt=l({}),Bt=l(!1),Ft=i(()=>Ge()),zt=i(()=>{const e={};return Ve.value&&Ft.value&&"+"!==Ft.value&&(e[Ve.value]=Ft.value),e});function Ut(){Vt(!0),qt.value={}}function Vt(e){Ot.value=!!e,Ot.value?qt.value={}:(qt.value={},Bt.value=!1)}function Kt(){Vt(!1)}async function Lt(){if(Ue.value){Bt.value=!0;try{const e=await oe.post(`/items/${Ue.value}`,qt.value,{params:{fields:[me.value]}}),t=e?.data?.data??null,a=t?.[me.value]??t?.id??null;null!=a&&ut([...Te.value,a]),Vt(!1)}catch{}finally{Bt.value=!1}}}return(e,t)=>{const a=u("v-button"),n=u("v-icon"),l=u("v-drawer"),i=u("v-form");return c(),d("div",N,[v("div",j,[v("div",D,[f(' <div class="sg__label">Related</div> '),Te.value.length?(c(),d("div",$,p(Te.value.length),1)):f("v-if",!0)]),v("div",E,[_(fe)?(c(),m(a,{key:0,secondary:"",disabled:_(ce)||!Ue.value,onClick:Tt},{default:h(()=>[...t[1]||(t[1]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),g(a,{secondary:"",disabled:_(ce)||Te.value.length<2,onClick:ct},{default:h(()=>[g(n,{name:"shuffle",small:""})]),_:1},8,["disabled"]),_(ve)?(c(),m(a,{key:1,disabled:_(ce)||!Ue.value,onClick:Ut},{default:h(()=>[...t[2]||(t[2]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])]),ze.value?(c(),d("div",T," Unable to resolve relation metadata for this O2M field. The grid can still render existing values, but “Add Existing” / “Create New” may not work. ")):Fe.value?(c(),d("div",I,"Loading relation…")):Ue.value?f("v-if",!0):(c(),d("div",O," No related collection detected for this O2M field. ")),Re.value?f("v-if",!0):(c(),d("div",q," This relationship has no manual sort field configured. Drag reordering might not persist server-side until a sort field is set in the relationship settings. ")),v("div",{class:"sg__grid",style:x(qe.value),onDragover:b(mt,["prevent"]),onDrop:b(_t,["prevent"])},[(c(!0),d(w,null,k(We.value,e=>(c(),d("div",{key:Me(e),class:S(["sg__card",{"sg__card--dragging":vt.value===Me(e),"sg__card--drag-over":ft.value===Me(e)}]),draggable:!_(ce),onDragstart:t=>function(e,t){ce.value||(vt.value=Me(e),ft.value=null,t?.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",vt.value)))}(e,t),onDragend:gt,onDragover:b(t=>function(e){if(!vt.value)return;const t=Me(e);t!==vt.value&&(ft.value=t)}(e),["prevent"]),onDrop:b(t=>pt(e),["prevent"])},[v("div",F,[rt(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:rt(e),alt:""},null,8,z)):(c(),d("div",U,[g(n,{name:"image"})])),v("div",V,[g(a,{icon:"",small:"",secondary:"",class:"sg__icon-btn",disabled:_(ce),onClick:b(t=>function(e){const t=Me(e);ut(Te.value.filter(e=>Me(e)!==t))}(e),["stop"])},{default:h(()=>[g(n,{name:"close"})]),_:1},8,["disabled","onClick"]),v("div",K,[g(n,{name:"drag_indicator"})])])]),v("div",L,[v("div",R,p(at(e)),1),v("div",G,p(nt(e)),1)])],42,B))),128)),0===Te.value.length?(c(),d("div",H,[t[5]||(t[5]=v("div",{class:"sg__empty-title"},"No related items",-1)),v("div",J,[_(fe)?(c(),m(a,{key:0,small:"",secondary:"",disabled:_(ce)||!Ue.value,onClick:Tt},{default:h(()=>[...t[3]||(t[3]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),_(ve)?(c(),m(a,{key:1,small:"",disabled:_(ce)||!Ue.value,onClick:Ut},{default:h(()=>[...t[4]||(t[4]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])])):f("v-if",!0),v("div",{ref_key:"sentinelEl",ref:Ze,class:"sg__sentinel"},null,512)],36),f(" Select Existing "),g(l,{title:"Add Existing","model-value":ht.value,"onUpdate:modelValue":$t,onCancel:Et},{actions:h(()=>[v("div",le,[f(' <div class="sg__drawer-search">\n\t\t\t\t\t\t<v-input small v-model="selectSearch" placeholder="Search…" @update:modelValue="onSelectSearchChange" />\n\t\t\t\t\t</div> '),g(a,{disabled:0===kt.value.size,onClick:It},{default:h(()=>[y(" Add "+p(kt.value.size),1)]),_:1},8,["disabled"])])]),default:h(()=>[v("div",{ref_key:"selectGridEl",ref:Ct,class:"sg__drawer-grid"},[(c(!0),d(w,null,k(Nt.value,e=>(c(),d("div",{key:Me(e[me.value]),class:S(["sg__card sg__card--select",{"sg__card--selected":kt.value.has(Me(e[me.value]))}]),onClick:t=>function(e){const t=Me(e),a=new Map(kt.value);a.has(t)?a.delete(t):a.set(t,e),kt.value=a}(e[me.value])},[v("div",Q,[ot(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:ot(e),alt:""},null,8,W)):(c(),d("div",X,[g(n,{name:"image"})]))]),v("div",Y,[v("div",Z,p(Ne(e,xe.value)??"—"),1),v("div",ee,p(Ne(e,we.value)??""),1)])],10,P))),128)),wt.value?(c(),d("div",te,"Failed to load items.")):xt.value&&0===Nt.value.length?(c(),d("div",ae,"Loading…")):xt.value||0!==Nt.value.length?f("v-if",!0):(c(),d("div",ne,"No items available.")),v("div",{ref_key:"selectSentinelEl",ref:At,class:"sg__sentinel"},null,512)],512)]),_:1},8,["model-value"]),f(" Create New "),g(l,{title:"Create New","model-value":Ot.value,"onUpdate:modelValue":Vt,onCancel:Kt},{actions:h(()=>[g(a,{disabled:Bt.value||!Ue.value,onClick:Lt},{default:h(()=>[y(p(Bt.value?"Creating…":"Create"),1)]),_:1},8,["disabled"])]),default:h(()=>[Ue.value?(c(),d("div",re,[g(i,{collection:Ue.value,modelValue:qt.value,"onUpdate:modelValue":t[0]||(t[0]=e=>qt.value=e),"initial-values":zt.value},null,8,["collection","modelValue","initial-values"])])):(c(),d("div",ie,"No related collection available."))]),_:1},8,["model-value"])])}}};var se=a({id:"sortable-grid",name:"Sortable Grid",icon:"grid_view",description:"Edit a one-to-many relation using a grid of related items.",types:["alias"],localTypes:["o2m"],group:"relational",relational:!0,component:M(oe,[["__scopeId","data-v-687375e2"]]),recommendedDisplays:["related-values"],options:({relations:e,field:{meta:t}})=>{const a=e.o2m?.collection;return[{field:"related_collection",name:"Related Collection",type:"string",meta:{width:"half",interface:"system-collection",note:"Manually specify the related collection if auto-detection fails."}},{field:"foreign_key",name:"Foreign Key Field",type:"string",meta:{width:"half",interface:"input",note:"Manually specify the field in the related collection that points to this item."}},{field:"card_cover",name:"Card Cover",type:"string",meta:{width:"full",interface:"system-field",options:{collectionName:a}}},{field:"card_title",name:"Card Title",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"card_subtitle_key",name:"Card Subtitle",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"columns",name:"Columns",type:"integer",schema:{default_value:6,min:1,max:12},meta:{width:"half",interface:"input"}},{field:"limit",name:"$t:per_page",type:"integer",schema:{default_value:1e3},meta:{width:"half",interface:"input"}},{field:"sort_field",name:"Sort Field",type:"string",meta:{width:"full",interface:"system-field",note:"Optional override. Used when the relationship sort field cannot be detected automatically.",options:{collectionName:a}}}]}});export{se as default};
