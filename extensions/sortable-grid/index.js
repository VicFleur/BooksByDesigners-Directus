import{useApi as e,useStores as t,defineInterface as a}from"@directus/extensions-sdk";import{toRefs as n,ref as l,computed as i,watch as r,onMounted as o,onBeforeUnmount as s,resolveComponent as d,createElementBlock as u,openBlock as c,createElementVNode as v,createCommentVNode as f,createVNode as g,toDisplayString as p,createBlock as m,unref as _,withCtx as h,createTextVNode as y,withModifiers as b,normalizeStyle as x,Fragment as w,renderList as k,normalizeClass as S}from"vue";var C=[],A=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var r=C.indexOf(i);-1===r&&(r=C.push(i)-1,A[r]={}),a=A[r]&&A[r][n]?A[r][n]:A[r][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var r="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(r,e),e}}("\n.sg[data-v-4fccfd67] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n.sg__toolbar[data-v-4fccfd67] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tgap: 12px;\n}\n.sg__toolbar-left[data-v-4fccfd67] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__label[data-v-4fccfd67] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n}\n.sg__count[data-v-4fccfd67] {\n\tpadding: 2px 8px;\n\tborder-radius: 999px;\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n}\n.sg__toolbar-right[data-v-4fccfd67] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n}\n.sg__notice[data-v-4fccfd67] {\n\tpadding: 10px 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__grid[data-v-4fccfd67] {\n\tdisplay: grid;\n\tgap: 12px;\n}\n.sg__card[data-v-4fccfd67] {\n\tborder: 1px solid var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background);\n\tuser-select: none;\n\tcursor: grab;\n}\n.sg__card--select[data-v-4fccfd67] {\n\tcursor: pointer;\n}\n.sg__card--disabled[data-v-4fccfd67] {\n\topacity: 0.5;\n\tpointer-events: none;\n}\n.sg__card--selected[data-v-4fccfd67] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__card--dragging[data-v-4fccfd67] {\n\topacity: 0.6;\n}\n.sg__card--drag-over[data-v-4fccfd67] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__cover[data-v-4fccfd67] {\n\tposition: relative;\n\taspect-ratio: 1 / 1;\n\tbackground: var(--theme--background-subdued);\n}\n\n/* Fallback for browsers without `aspect-ratio` */\n@supports not (aspect-ratio: 1 / 1) {\n.sg__cover[data-v-4fccfd67]::before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tpadding-top: 100%;\n}\n.sg__cover-img[data-v-4fccfd67],\n\t.sg__cover-placeholder[data-v-4fccfd67] {\n\t\tposition: absolute;\n\t\tinset: 0;\n}\n}\n.sg__cover-img[data-v-4fccfd67] {\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n}\n.sg__cover-placeholder[data-v-4fccfd67] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__card-actions[data-v-4fccfd67] {\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 6px;\n}\n.sg__drag-handle[data-v-4fccfd67] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 999px;\n\tbackground: color-mix(in srgb, var(--theme--background) 85%, transparent);\n\tborder: 1px solid var(--theme--border-color);\n\tcolor: var(--theme--foreground-subdued);\n\tcursor: grab;\n}\n.sg__card-body[data-v-4fccfd67] {\n\tpadding: 10px 12px 12px;\n}\n.sg__title[data-v-4fccfd67] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n\tline-height: 1.2;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.4em;\n}\n.sg__subtitle[data-v-4fccfd67] {\n\tmargin-top: 4px;\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n\tline-height: 1.3;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.6em;\n}\n.sg__sentinel[data-v-4fccfd67] {\n\theight: 1px;\n}\n.sg__empty[data-v-4fccfd67] {\n\tgrid-column: 1 / -1;\n\tpadding: 28px 12px;\n\ttext-align: center;\n\tborder: 1px dashed var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__empty-title[data-v-4fccfd67] {\n\tfont-weight: 600;\n\tmargin-bottom: 10px;\n\tcolor: var(--theme--foreground);\n}\n.sg__empty-actions[data-v-4fccfd67] {\n\tdisplay: inline-flex;\n\tgap: 8px;\n}\n.sg__drawer-grid[data-v-4fccfd67] {\n\tpadding: 0 16px 100px 16px;\n\tdisplay: grid;\n\tgap: 12px;\n\tgrid-template-columns: repeat(3, minmax(0, 1fr));\n\talign-content: start;\n}\n.sg__drawer-form[data-v-4fccfd67] {\n\theight: 100%;\n\toverflow: auto;\n\tpadding: 16px;\n}\n.sg__drawer-state[data-v-4fccfd67] {\n\tgrid-column: 1 / -1;\n\tpadding: 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__drawer-actions[data-v-4fccfd67] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__drawer-search[data-v-4fccfd67] {\n\tflex: 1 1 auto;\n\tmin-width: 220px;\n}\n@media (max-width: 600px) {\n.sg__drawer-grid[data-v-4fccfd67] {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr));\n}\n.sg__drawer-search[data-v-4fccfd67] {\n\t\tmin-width: 0;\n}\n}\n",{});var M=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a};const N={class:"sg"},T={class:"sg__toolbar"},D={class:"sg__toolbar-left"},j={key:0,class:"sg__count"},$={class:"sg__toolbar-right"},E={key:0,class:"sg__notice"},O={key:1,class:"sg__notice"},I={key:2,class:"sg__notice"},B={key:3,class:"sg__notice"},V=["draggable","onDragstart","onDragover","onDrop"],z={class:"sg__cover"},U=["src"],q={key:1,class:"sg__cover-placeholder"},F={class:"sg__card-actions"},L={class:"sg__drag-handle",title:"Drag to reorder"},G={class:"sg__card-body"},K={class:"sg__title"},R={class:"sg__subtitle"},H={key:0,class:"sg__empty"},J={class:"sg__empty-actions"},P=["onClick"],Q={class:"sg__cover"},W=["src"],X={key:1,class:"sg__cover-placeholder"},Y={class:"sg__card-body"},Z={class:"sg__title"},ee={class:"sg__subtitle"},te={key:0,class:"sg__drawer-state"},ae={key:1,class:"sg__drawer-state"},ne={key:2,class:"sg__drawer-state"},le={class:"sg__drawer-actions"},ie={class:"sg__drawer-search"},re={key:0,class:"sg__drawer-state"},oe={key:1,class:"sg__drawer-form"},se={__name:"interface",props:{value:{type:Array,default:()=>[]},primaryKey:{type:String,default:"id"},collection:{type:String,required:!0},field:{type:String,required:!0},width:{type:String,default:"full"},disabled:{type:Boolean,default:!1},layout:{type:String,default:"grid"},tableSpacing:{type:String,default:"cozy"},version:{type:String,default:"1.0.0"},fields:{type:Array,default:()=>["id"]},template:{type:String,default:null},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0},filter:{type:Object,default:()=>null},enableSearchFilter:{type:Boolean,default:!1},enableLink:{type:Boolean,default:!0},limit:{type:Number,default:1e3},sort:{type:String,default:"id"},sortDirection:{type:String,default:"asc"}},emits:["input"],setup(a,{emit:C}){const A=a,M=C,se=e(),{collection:de,field:ue,primaryKey:ce,disabled:ve,enableCreate:fe,enableSelect:ge}=n(A),{useFieldsStore:pe}=t(),me=pe(),_e=l("id"),he=i(()=>me.getField(de.value,ue.value)?.meta||{}),ye=i(()=>he.value?.options??{});function be(e){if(!e)return null;if("string"!=typeof e)return null;let t=e.trim();if(!t)return null;const a=t.match(/^\{\{\s*([^}]+?)\s*\}\}$/);return a&&(t=a[1].trim()),t=t.replace(/\s*>\s*/g,"."),t=t.replace(/\s*\.\s*/g,".").replace(/\s+/g,""),t=t.replace(/^\.+/,"").replace(/\.+$/,""),t||null}const xe=i(()=>be(ye.value.card_cover)),we=i(()=>be(ye.value.card_title)),ke=i(()=>be(ye.value.card_subtitle)),Se=i(()=>Number(ye.value.columns||6)),Ce=i(()=>Number(ye.value.limit||1e3));function Ae(e){return String(e)}function Me(e,t){if(!e||!t)return null;if("string"!=typeof t)return null;const a=t.split(".").filter(Boolean);let n=e;for(const e of a){if(null==n)return null;n=n[e]}return n??null}function Ne(e){return null==e?null:"object"==typeof e?e[_e.value]??e.id??null:e}const Te=l(Array.isArray(A.value)?A.value:[]);r(()=>A.value,e=>{Te.value=Array.isArray(e)?e:[]},{deep:!0});const De=i(()=>{const e=Te.value;if(!Array.isArray(e))return[];const t=new Set,a=[];for(const n of e){const e=Ne(n);if(null==e)continue;const l=Ae(e);t.has(l)||(t.add(l),a.push(e))}return a}),je=i(()=>[...De.value].reverse()),$e=i(()=>new Set(De.value.map(Ae))),Ee=i(()=>({gridTemplateColumns:`repeat(${Math.max(1,Se.value||6)}, minmax(0, 1fr))`})),Oe=l(null),Ie=l(!1),Be=l(null),Ve=i(()=>Oe.value?.collection??null),ze=i(()=>Oe.value?.field??null),Ue=i(()=>Oe.value?.meta?.sort_field??null),qe=i(()=>be(ye.value.sort_field)),Fe=i(()=>qe.value||Ue.value||null);r(Ve,()=>{!async function(){if(Ve.value)try{const e=await se.get(`/fields/${Ve.value}`,{params:{limit:-1}}),t=e?.data?.data??[],a=t.find(e=>e?.schema?.is_primary_key)?.field;_e.value=a||"id"}catch{_e.value="id"}else _e.value="id"}()},{immediate:!0}),r([de,ue],()=>{!async function(){Be.value=null,Ie.value=!0,Oe.value=null;try{const e=await se.get("/relations",{params:{filter:{related_collection:{_eq:de.value},meta:{one_field:{_eq:ue.value}}},limit:1}});Oe.value=e?.data?.data?.[0]??null}catch(e){Be.value=e,Oe.value=null}finally{Ie.value=!1}}()},{immediate:!0});const Le=l(new Map),Ge=l(new Set);r(()=>Te.value,e=>{if(Array.isArray(e))for(const t of e)if(t&&"object"==typeof t){const e=Ne(t);if(null==e)continue;Le.value.set(Ae(e),t)}},{deep:!0,immediate:!0});const Ke=i(()=>{const e=new Set([_e.value]),t=xe.value,a=we.value,n=ke.value;return t&&e.add(t),a&&e.add(a),n&&e.add(n),Array.from(e)}),Re=l(0);r(()=>De.value.length,(e,t)=>{const a="number"==typeof t?t:0;0!==Re.value?e>a&&Re.value>=a?Re.value=e:Re.value=Math.min(Re.value,e):Re.value=Math.min(e,Math.max(1,Ce.value||1e3))},{immediate:!0});const He=i(()=>je.value.slice(0,Re.value));async function Je(){if(!Ve.value)return;const e=[];for(const t of He.value){const a=Ae(t);Le.value.has(a)||(Ge.value.has(a)||(Ge.value.add(a),e.push(t)))}e.length&&await async function(e){if(!Ve.value)return;if(!e.length)return;const t=_e.value,a=Ke.value;for(let n=0;n<e.length;n+=100){const l=e.slice(n,n+100);try{const e=await se.get(`/items/${Ve.value}`,{params:{fields:a,filter:{[t]:{_in:l}},limit:-1}}),n=e?.data?.data??[];for(const e of n){const a=e?.[t]??e?.id;null!=a&&Le.value.set(Ae(a),e)}}catch{}finally{for(const e of l)Ge.value.delete(Ae(e))}}}(e)}r([He,Ke,Ve],()=>{Je()},{immediate:!0});const Pe=l(null);let Qe=null;function We(e){return Le.value.get(Ae(e))??null}function Xe(e){return(Me(We(e),we.value)??"—")+""}function Ye(e){const t=Me(We(e),ke.value);return null==t?"":String(t)}function Ze(e){return null==e?null:"string"==typeof e||"number"==typeof e?e:"object"==typeof e?e.id??e[_e.value]??null:null}function et(e){return e?`/assets/${encodeURIComponent(String(e))}?fit=cover&width=600&height=600&quality=80`:null}function tt(e){const t=We(e);if(!t||!xe.value)return null;const a=Me(t,xe.value);if(a&&"object"==typeof a&&"string"==typeof a.$thumbnail)return a.$thumbnail;return et(Ze(a))}function at(e){if(!e||!xe.value)return null;const t=Me(e,xe.value);if(t&&"object"==typeof t&&"string"==typeof t.$thumbnail)return t.$thumbnail;return et(Ze(t))}o(()=>{Qe=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&function(){const e=De.value.length;Re.value>=e||(Re.value=Math.min(e,Re.value+Math.max(1,Ce.value||1e3)))}()},{root:null,rootMargin:"300px",threshold:.01}),Pe.value&&Qe.observe(Pe.value)}),r(Pe,(e,t)=>{Qe&&(t&&Qe.unobserve(t),e&&Qe.observe(e))},{flush:"post"}),s(()=>{Qe&&Qe.disconnect()});const nt=i(()=>{const e=Te.value;return!(!Array.isArray(e)||0===e.length)&&"object"==typeof e[0]});function lt(e){const t=function(e){if(!nt.value)return e;const t=new Map;for(const e of Te.value){const a=Ne(e);null!=a&&t.set(Ae(a),e)}return e.map(e=>t.get(Ae(e))??{[_e.value]:e})}(e);Te.value=t,M("input",t)}function it(e){lt([...e].reverse())}const rt=l(null),ot=l(null);function st(){rt.value=null,ot.value=null}function dt(e){if(!rt.value)return;const t=Ae(e);t!==rt.value&&function(e,t){const a=[...je.value],n=a.findIndex(t=>Ae(t)===e);let l=a.findIndex(e=>Ae(e)===t);if(-1===n||-1===l)return;const[i]=a.splice(n,1);n<l&&(l-=1),a.splice(l,0,i),it(a)}(rt.value,t),st()}function ut(){}function ct(){if(!rt.value)return;const e=[...je.value],t=e.findIndex(e=>Ae(e)===rt.value);if(-1===t)return st();const[a]=e.splice(t,1);e.push(a),it(e),st()}const vt=l(!1),ft=l(""),gt=l([]),pt=l(!1),mt=l(!1),_t=l(new Map),ht=l(0),yt=l(!0),bt=l(null),xt=l(null);let wt=null;const kt=i(()=>Math.max(1,Math.min(100,Ce.value||50)));function St(){gt.value=[],ht.value=0,yt.value=!0,mt.value=!1}async function Ct(){if(Ve.value&&yt.value&&!pt.value){pt.value=!0,mt.value=!1;try{const e=kt.value,t=ht.value,a=_e.value,n=await se.get(`/items/${Ve.value}`,{params:{fields:Ke.value,limit:e,offset:t,search:ft.value||void 0,filter:A.filter||void 0}}),l=n?.data?.data??[],i=new Set(gt.value.map(e=>Ae(e?.[a]??e?.id))),r=[...gt.value];for(const e of l){const t=Ae(e?.[a]??e?.id);i.has(t)||(i.add(t),r.push(e))}gt.value=r,ht.value+=l.length;const o=n?.data?.meta?.filter_count??n?.data?.meta?.total_count??null;yt.value="number"==typeof o?ht.value<o:l.length===e}catch{mt.value=!0,yt.value=!1}finally{pt.value=!1}}}function At(){wt&&wt.disconnect(),wt=null}r([vt,bt,xt],()=>(At(),void(vt.value&&bt.value&&xt.value&&(wt=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&Ct()},{root:bt.value,rootMargin:"300px",threshold:.01}),wt.observe(xt.value)))),{flush:"post"});let Mt=null;function Nt(){vt.value&&(Mt&&clearTimeout(Mt),Mt=setTimeout(()=>{St(),Ct()},250))}function Tt(e){vt.value=!!e,vt.value?(_t.value=new Map,St(),Ct()):(At(),_t.value=new Map)}function Dt(){Tt(!1)}function jt(){Tt(!0)}function $t(){const e=De.value,t=new Set(e.map(Ae)),a=[];for(const[e,n]of _t.value.entries())t.has(e)||a.push(n);lt([...e,...a]),Tt(!1)}s(()=>{At(),Mt&&clearTimeout(Mt)});const Et=l(!1),Ot=l({}),It=l(!1),Bt=i(()=>{try{if(null!=ce.value&&"+"!==ce.value&&"id"!==ce.value)return ce.value;const e=(window.location.pathname||"").split("/").filter(Boolean),t=e.indexOf("content");return-1!==t&&e.length>=t+3?e[t+2]:null}catch{return null}}),Vt=i(()=>{const e={};return ze.value&&Bt.value&&"+"!==Bt.value&&(e[ze.value]=Bt.value),e});function zt(){Ut(!0),Ot.value={}}function Ut(e){Et.value=!!e,Et.value?Ot.value={}:(Ot.value={},It.value=!1)}function qt(){Ut(!1)}async function Ft(){if(Ve.value){It.value=!0;try{const e=await se.post(`/items/${Ve.value}`,Ot.value,{params:{fields:[_e.value]}}),t=e?.data?.data??null,a=t?.[_e.value]??t?.id??null;null!=a&&lt([...De.value,a]),Ut(!1)}catch{}finally{It.value=!1}}}return(e,t)=>{const a=d("v-button"),n=d("v-icon"),l=d("v-input"),i=d("v-drawer"),r=d("v-form");return c(),u("div",N,[v("div",T,[v("div",D,[t[2]||(t[2]=v("div",{class:"sg__label"},"Related",-1)),De.value.length?(c(),u("div",j,p(De.value.length),1)):f("v-if",!0)]),v("div",$,[_(ge)?(c(),m(a,{key:0,small:"",secondary:"",disabled:_(ve)||!Ve.value,onClick:jt},{default:h(()=>[...t[3]||(t[3]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),_(fe)?(c(),m(a,{key:1,small:"",disabled:_(ve)||!Ve.value,onClick:zt},{default:h(()=>[...t[4]||(t[4]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])]),Be.value?(c(),u("div",E," Unable to resolve relation metadata for this O2M field. The grid can still render existing values, but “Add Existing” / “Create New” may not work. ")):Ie.value?(c(),u("div",O,"Loading relation…")):Ve.value?f("v-if",!0):(c(),u("div",I," No related collection detected for this O2M field. ")),Fe.value?f("v-if",!0):(c(),u("div",B," This relationship has no manual sort field configured. Drag reordering might not persist server-side until a sort field is set in the relationship settings. ")),v("div",{class:"sg__grid",style:x(Ee.value),onDragover:b(ut,["prevent"]),onDrop:b(ct,["prevent"])},[(c(!0),u(w,null,k(He.value,e=>(c(),u("div",{key:Ae(e),class:S(["sg__card",{"sg__card--dragging":rt.value===Ae(e),"sg__card--drag-over":ot.value===Ae(e)}]),draggable:!_(ve),onDragstart:t=>function(e,t){ve.value||(rt.value=Ae(e),ot.value=null,t?.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",rt.value)))}(e,t),onDragend:st,onDragover:b(t=>function(e){if(!rt.value)return;const t=Ae(e);t!==rt.value&&(ot.value=t)}(e),["prevent"]),onDrop:b(t=>dt(e),["prevent"])},[v("div",z,[tt(e)?(c(),u("img",{key:0,class:"sg__cover-img",src:tt(e),alt:""},null,8,U)):(c(),u("div",q,[g(n,{name:"image"})])),v("div",F,[g(a,{icon:"",small:"",secondary:"",class:"sg__icon-btn",disabled:_(ve),onClick:b(t=>function(e){const t=Ae(e);lt(De.value.filter(e=>Ae(e)!==t))}(e),["stop"])},{default:h(()=>[g(n,{name:"close"})]),_:1},8,["disabled","onClick"]),v("div",L,[g(n,{name:"drag_indicator"})])])]),v("div",G,[v("div",K,p(Xe(e)),1),v("div",R,p(Ye(e)),1)])],42,V))),128)),0===De.value.length?(c(),u("div",H,[t[7]||(t[7]=v("div",{class:"sg__empty-title"},"No related items",-1)),v("div",J,[_(ge)?(c(),m(a,{key:0,small:"",secondary:"",disabled:_(ve)||!Ve.value,onClick:jt},{default:h(()=>[...t[5]||(t[5]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),_(fe)?(c(),m(a,{key:1,small:"",disabled:_(ve)||!Ve.value,onClick:zt},{default:h(()=>[...t[6]||(t[6]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])])):f("v-if",!0),v("div",{ref_key:"sentinelEl",ref:Pe,class:"sg__sentinel"},null,512)],36),f(" Select Existing "),g(i,{title:"Add Existing","model-value":vt.value,"onUpdate:modelValue":Tt,onCancel:Dt},{actions:h(()=>[v("div",le,[v("div",ie,[g(l,{modelValue:ft.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>ft.value=e),Nt],placeholder:"Search…"},null,8,["modelValue"])]),g(a,{disabled:0===_t.value.size,onClick:$t},{default:h(()=>[y(" Add "+p(_t.value.size),1)]),_:1},8,["disabled"])])]),default:h(()=>[v("div",{ref_key:"selectGridEl",ref:bt,class:"sg__drawer-grid"},[(c(!0),u(w,null,k(gt.value,e=>(c(),u("div",{key:Ae(e[_e.value]),class:S(["sg__card sg__card--select",{"sg__card--selected":_t.value.has(Ae(e[_e.value])),"sg__card--disabled":$e.value.has(Ae(e[_e.value]))}]),onClick:t=>function(e){const t=Ae(e);if($e.value.has(t))return;const a=new Map(_t.value);a.has(t)?a.delete(t):a.set(t,e),_t.value=a}(e[_e.value])},[v("div",Q,[at(e)?(c(),u("img",{key:0,class:"sg__cover-img",src:at(e),alt:""},null,8,W)):(c(),u("div",X,[g(n,{name:"image"})]))]),v("div",Y,[v("div",Z,p(Me(e,we.value)??"—"),1),v("div",ee,p(Me(e,ke.value)??""),1)])],10,P))),128)),mt.value?(c(),u("div",te,"Failed to load items.")):pt.value&&0===gt.value.length?(c(),u("div",ae,"Loading…")):pt.value||0!==gt.value.length?f("v-if",!0):(c(),u("div",ne,"No items found.")),v("div",{ref_key:"selectSentinelEl",ref:xt,class:"sg__sentinel"},null,512)],512)]),_:1},8,["model-value"]),f(" Create New "),g(i,{title:"Create New","model-value":Et.value,"onUpdate:modelValue":Ut,onCancel:qt},{actions:h(()=>[g(a,{disabled:It.value||!Ve.value,onClick:Ft},{default:h(()=>[y(p(It.value?"Creating…":"Create"),1)]),_:1},8,["disabled"])]),default:h(()=>[Ve.value?(c(),u("div",oe,[g(r,{collection:Ve.value,modelValue:Ot.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Ot.value=e),"initial-values":Vt.value},null,8,["collection","modelValue","initial-values"])])):(c(),u("div",re,"No related collection available."))]),_:1},8,["model-value"])])}}};var de=a({id:"sortable-grid",name:"Sortable Grid",icon:"grid_view",description:"Edit a one-to-many relation using a grid of related items.",types:["alias"],localTypes:["o2m"],group:"relational",relational:!0,component:M(se,[["__scopeId","data-v-4fccfd67"]]),recommendedDisplays:["related-values"],options:({relations:e,field:{meta:t}})=>{const a=e.o2m?.collection;return[{field:"card_cover",name:"Card Cover",type:"string",meta:{width:"full",interface:"system-field",options:{collectionName:a}}},{field:"card_title",name:"Card Title",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"card_subtitle",name:"Card Subtitle",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"columns",name:"Columns",type:"integer",schema:{default_value:6,min:1,max:12},meta:{width:"half",interface:"input"}},{field:"limit",name:"$t:per_page",type:"integer",schema:{default_value:1e3},meta:{width:"half",interface:"input"}},{field:"sort_field",name:"Sort Field",type:"string",meta:{width:"full",interface:"system-field",note:"Optional override. Used when the relationship sort field cannot be detected automatically.",options:{collectionName:a}}}]}});export{de as default};
