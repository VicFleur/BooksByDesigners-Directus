import{useApi as e,useStores as t,defineInterface as a}from"@directus/extensions-sdk";import{toRefs as n,ref as l,computed as i,watch as r,onMounted as o,onBeforeUnmount as s,resolveComponent as u,createElementBlock as d,openBlock as c,createElementVNode as v,createCommentVNode as f,createVNode as g,toDisplayString as p,createBlock as m,unref as _,withCtx as h,createTextVNode as y,withModifiers as b,normalizeStyle as x,Fragment as w,renderList as k,normalizeClass as S}from"vue";var C=[],A=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var r=C.indexOf(i);-1===r&&(r=C.push(i)-1,A[r]={}),a=A[r]&&A[r][n]?A[r][n]:A[r][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var r="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(r,e),e}}("\n.sg[data-v-325a463a] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n.sg__toolbar[data-v-325a463a] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tgap: 12px;\n}\n.sg__toolbar-left[data-v-325a463a] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__label[data-v-325a463a] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n}\n.sg__count[data-v-325a463a] {\n\tpadding: 2px 8px;\n\tborder-radius: 999px;\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n}\n.sg__toolbar-right[data-v-325a463a] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n}\n.sg__notice[data-v-325a463a] {\n\tpadding: 10px 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__grid[data-v-325a463a] {\n\tdisplay: grid;\n\tgap: 12px;\n}\n.sg__card[data-v-325a463a] {\n\tborder: 1px solid var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background);\n\tuser-select: none;\n\tcursor: grab;\n}\n.sg__card--select[data-v-325a463a] {\n\tcursor: pointer;\n}\n.sg__card--selected[data-v-325a463a] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__card--dragging[data-v-325a463a] {\n\topacity: 0.6;\n}\n.sg__card--drag-over[data-v-325a463a] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__cover[data-v-325a463a] {\n\tposition: relative;\n\taspect-ratio: 1 / 1;\n\tbackground: var(--theme--background-subdued);\n}\n\n/* Fallback for browsers without `aspect-ratio` */\n@supports not (aspect-ratio: 1 / 1) {\n.sg__cover[data-v-325a463a]::before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tpadding-top: 100%;\n}\n.sg__cover-img[data-v-325a463a],\n\t.sg__cover-placeholder[data-v-325a463a] {\n\t\tposition: absolute;\n\t\tinset: 0;\n}\n}\n.sg__cover-img[data-v-325a463a] {\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n}\n.sg__cover-placeholder[data-v-325a463a] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__card-actions[data-v-325a463a] {\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 6px;\n}\n.sg__drag-handle[data-v-325a463a] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 999px;\n\tbackground: color-mix(in srgb, var(--theme--background) 85%, transparent);\n\tborder: 1px solid var(--theme--border-color);\n\tcolor: var(--theme--foreground-subdued);\n\tcursor: grab;\n}\n.sg__card-body[data-v-325a463a] {\n\tpadding: 10px 12px 12px;\n}\n.sg__title[data-v-325a463a] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n\tline-height: 1.2;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.4em;\n}\n.sg__subtitle[data-v-325a463a] {\n\tmargin-top: 4px;\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n\tline-height: 1.3;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.6em;\n}\n.sg__sentinel[data-v-325a463a] {\n\theight: 1px;\n}\n.sg__empty[data-v-325a463a] {\n\tgrid-column: 1 / -1;\n\tpadding: 28px 12px;\n\ttext-align: center;\n\tborder: 1px dashed var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__empty-title[data-v-325a463a] {\n\tfont-weight: 600;\n\tmargin-bottom: 10px;\n\tcolor: var(--theme--foreground);\n}\n.sg__empty-actions[data-v-325a463a] {\n\tdisplay: inline-flex;\n\tgap: 8px;\n}\n.sg__drawer-grid[data-v-325a463a] {\n\tpadding: 0 16px 100px 16px;\n\tdisplay: grid;\n\tgap: 12px;\n\tgrid-template-columns: repeat(3, minmax(0, 1fr));\n\talign-content: start;\n}\n.sg__drawer-form[data-v-325a463a] {\n\theight: 100%;\n\toverflow: auto;\n\tpadding: 16px;\n}\n.sg__drawer-state[data-v-325a463a] {\n\tgrid-column: 1 / -1;\n\tpadding: 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__drawer-actions[data-v-325a463a] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__drawer-search[data-v-325a463a] {\n\tflex: 1 1 auto;\n\tmin-width: 220px;\n}\n@media (max-width: 600px) {\n.sg__drawer-grid[data-v-325a463a] {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr));\n}\n.sg__drawer-search[data-v-325a463a] {\n\t\tmin-width: 0;\n}\n}\n",{});var M=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a};const N={class:"sg"},j={class:"sg__toolbar"},D={class:"sg__toolbar-left"},$={key:0,class:"sg__count"},E={class:"sg__toolbar-right"},T={key:0,class:"sg__notice"},O={key:1,class:"sg__notice"},I={key:2,class:"sg__notice"},B={key:3,class:"sg__notice"},q=["draggable","onDragstart","onDragover","onDrop"],z={class:"sg__cover"},F=["src"],U={key:1,class:"sg__cover-placeholder"},V={class:"sg__card-actions"},L={class:"sg__drag-handle",title:"Drag to reorder"},G={class:"sg__card-body"},K={class:"sg__title"},R={class:"sg__subtitle"},H={key:0,class:"sg__empty"},J={class:"sg__empty-actions"},P=["onClick"],Q={class:"sg__cover"},W=["src"],X={key:1,class:"sg__cover-placeholder"},Y={class:"sg__card-body"},Z={class:"sg__title"},ee={class:"sg__subtitle"},te={key:0,class:"sg__drawer-state"},ae={key:1,class:"sg__drawer-state"},ne={key:2,class:"sg__drawer-state"},le={class:"sg__drawer-actions"},ie={key:0,class:"sg__drawer-state"},re={key:1,class:"sg__drawer-form"},oe={__name:"interface",props:{value:{type:Array,default:()=>[]},primaryKey:{type:String,default:"id"},collection:{type:String,required:!0},field:{type:String,required:!0},width:{type:String,default:"full"},disabled:{type:Boolean,default:!1},layout:{type:String,default:"grid"},tableSpacing:{type:String,default:"cozy"},version:{type:String,default:"1.0.0"},fields:{type:Array,default:()=>["id"]},template:{type:String,default:null},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0},filter:{type:Object,default:()=>null},enableSearchFilter:{type:Boolean,default:!1},enableLink:{type:Boolean,default:!0},limit:{type:Number,default:1e3},sort:{type:String,default:"id"},sortDirection:{type:String,default:"asc"}},emits:["input"],setup(a,{emit:C}){const A=a,M=C,oe=e(),{collection:se,field:ue,primaryKey:de,disabled:ce,enableCreate:ve,enableSelect:fe}=n(A),{useFieldsStore:ge}=t(),pe=ge(),me=l("id"),_e=i(()=>pe.getField(se.value,ue.value)?.meta||{}),he=i(()=>_e.value?.options??{});function ye(e){if(!e)return null;if("string"!=typeof e)return null;let t=e.trim();if(!t)return null;const a=t.match(/^\{\{\s*([^}]+?)\s*\}\}$/);return a&&(t=a[1].trim()),t=t.replace(/\s*>\s*/g,"."),t=t.replace(/\s*\.\s*/g,".").replace(/\s+/g,""),t=t.replace(/^\.+/,"").replace(/\.+$/,""),t||null}const be=i(()=>ye(he.value.card_cover)),xe=i(()=>ye(he.value.card_title)),we=i(()=>ye(he.value.card_subtitle_key)),ke=i(()=>Number(he.value.columns||6)),Se=i(()=>Number(he.value.limit||1e3));function Ce(e){return String(e)}function Ae(e,t){if(!e||!t)return null;if("string"!=typeof t)return null;const a=t.split(".").filter(Boolean);let n=e;for(const e of a){if(null==n)return null;n=n[e]}return n??null}function Me(e){return null==e?null:"object"==typeof e?e[me.value]??e.id??null:e}const Ne=l(Array.isArray(A.value)?A.value:[]),je=l(null),De=l(!1);r(()=>A.value,e=>{Ne.value=Array.isArray(e)?e:[],De.value||(je.value=null)},{deep:!0});const $e=i(()=>{if(je.value)return je.value;const e=Ne.value;if(!Array.isArray(e))return[];const t=new Set,a=[];for(const n of e){const e=Me(n);if(null==e)continue;const l=Ce(e);t.has(l)||(t.add(l),a.push(e))}return a}),Ee=i(()=>[...$e.value].reverse()),Te=i(()=>new Set($e.value.map(Ce))),Oe=i(()=>({gridTemplateColumns:`repeat(${Math.max(1,ke.value||6)}, minmax(0, 1fr))`})),Ie=l(null),Be=l(!1),qe=l(null),ze=i(()=>Ie.value?.collection??null),Fe=i(()=>Ie.value?.field??null),Ue=i(()=>Ie.value?.sort_field??Ie.value?.meta?.sort_field??null),Ve=i(()=>ye(he.value.sort_field)),Le=i(()=>Ve.value||Ue.value||null);function Ge(){if(null!=de.value&&"+"!==de.value&&"id"!==de.value)return de.value;try{const e=(window.location.pathname||"").split("/").filter(Boolean),t=e.indexOf("content");if(-1!==t&&e.length>=t+3)return e[t+2]}catch{}return null}r(ze,()=>{!async function(){if(ze.value)try{const e=await oe.get(`/fields/${ze.value}`,{params:{limit:-1}}),t=e?.data?.data??[],a=t.find(e=>e?.schema?.is_primary_key)?.field;me.value=a||"id"}catch{me.value="id"}else me.value="id"}()},{immediate:!0}),r([se,ue],()=>{!async function(){qe.value=null,Be.value=!0,Ie.value=null;try{const e=await oe.get("/relations",{params:{filter:{related_collection:{_eq:se.value},meta:{one_field:{_eq:ue.value}}},limit:1}});Ie.value=e?.data?.data?.[0]??null}catch(e){qe.value=e,Ie.value=null}finally{Be.value=!1}}()},{immediate:!0}),r([ze,Fe,()=>A.value],()=>{De.value=!1,je.value=null,async function(){if(!ze.value||!Fe.value)return;if(De.value)return;if((Array.isArray(A.value)?A.value.length:0)<100)return;const e=Ge();if(e)try{const t=me.value,a=Le.value,n=await oe.get(`/items/${ze.value}`,{params:{fields:[t],filter:{[Fe.value]:{_eq:e}},sort:a?[a]:void 0,limit:-1}}),l=(n?.data?.data??[]).map(e=>e[t]).filter(e=>null!=e);l.length>0&&(je.value=l)}catch{}finally{De.value=!0}}()},{immediate:!0});const Ke=l(new Map),Re=l(new Set);r(()=>Ne.value,e=>{if(Array.isArray(e))for(const t of e)if(t&&"object"==typeof t){const e=Me(t);if(null==e)continue;Ke.value.set(Ce(e),t)}},{deep:!0,immediate:!0});const He=i(()=>{const e=new Set([me.value]),t=be.value,a=xe.value,n=we.value;return t&&e.add(t),a&&e.add(a),n&&e.add(n),Array.from(e)}),Je=l(0);r(()=>$e.value.length,(e,t)=>{const a="number"==typeof t?t:0;0!==Je.value?e>a&&Je.value>=a?Je.value=e:Je.value=Math.min(Je.value,e):Je.value=Math.min(e,Math.max(1,Se.value||1e3))},{immediate:!0});const Pe=i(()=>Ee.value.slice(0,Je.value));function Qe(e){if(!e)return!1;const t=He.value;for(const a of t){if(!(a.split(".")[0]in e))return!1}return!0}async function We(){if(!ze.value)return;const e=[];for(const t of Pe.value){const a=Ce(t);if(Re.value.has(a))continue;const n=Ke.value.get(a);n&&Qe(n)||(Re.value.add(a),e.push(t))}e.length&&await async function(e){if(!ze.value)return;if(!e.length)return;const t=me.value,a=He.value;for(let n=0;n<e.length;n+=100){const l=e.slice(n,n+100);try{const e=await oe.get(`/items/${ze.value}`,{params:{fields:a,filter:{[t]:{_in:l}},limit:-1}}),n=e?.data?.data??[];for(const e of n){const a=e?.[t]??e?.id;null!=a&&Ke.value.set(Ce(a),e)}}catch{}finally{for(const e of l)Re.value.delete(Ce(e))}}}(e)}r([Pe,He,ze],()=>{We()},{immediate:!0});const Xe=l(null);let Ye=null;function Ze(e){return Ke.value.get(Ce(e))??null}function et(e){return(Ae(Ze(e),xe.value)??"—")+""}function tt(e){const t=Ae(Ze(e),we.value);return null==t?"":String(t)}function at(e){return null==e?null:"string"==typeof e||"number"==typeof e?e:"object"==typeof e?e.id??e[me.value]??null:null}function nt(e){return e?`/assets/${encodeURIComponent(String(e))}?fit=cover&width=600&height=600&quality=80`:null}function lt(e){const t=Ze(e);if(!t||!be.value)return null;const a=Ae(t,be.value);if(a&&"object"==typeof a&&"string"==typeof a.$thumbnail)return a.$thumbnail;return nt(at(a))}function it(e){if(!e||!be.value)return null;const t=Ae(e,be.value);if(t&&"object"==typeof t&&"string"==typeof t.$thumbnail)return t.$thumbnail;return nt(at(t))}o(()=>{Ye=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&function(){const e=$e.value.length;Je.value>=e||(Je.value=Math.min(e,Je.value+Math.max(1,Se.value||1e3)))}()},{root:null,rootMargin:"300px",threshold:.01}),Xe.value&&Ye.observe(Xe.value)}),r(Xe,(e,t)=>{Ye&&(t&&Ye.unobserve(t),e&&Ye.observe(e))},{flush:"post"}),s(()=>{Ye&&Ye.disconnect()});const rt=i(()=>{const e=Ne.value;return!(!Array.isArray(e)||0===e.length)&&"object"==typeof e[0]});function ot(e){const t=function(e){const t=Le.value;if(!rt.value&&!t)return e;const a=new Map;for(const e of Ne.value){const t=Me(e);null!=t&&a.set(Ce(t),e)}return e.map((e,n)=>{const l=a.get(Ce(e)),i=l&&"object"==typeof l?{...l}:{[me.value]:e};return t&&(i[t]=n),i})}(e);Ne.value=t,je.value=e,M("input",t)}function st(e){ot([...e].reverse())}function ut(){if($e.value.length<2)return;const e=[...$e.value];for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}ot(e)}const dt=l(null),ct=l(null);function vt(){dt.value=null,ct.value=null}function ft(e){if(!dt.value)return;const t=Ce(e);t!==dt.value&&function(e,t){const a=[...Ee.value],n=a.findIndex(t=>Ce(t)===e),l=a.findIndex(e=>Ce(e)===t);if(-1===n||-1===l||n===l)return;const[i]=a.splice(n,1);a.splice(l,0,i),st(a)}(dt.value,t),vt()}function gt(){}function pt(){if(!dt.value)return;const e=[...Ee.value],t=e.findIndex(e=>Ce(e)===dt.value);if(-1===t)return vt();const[a]=e.splice(t,1);e.push(a),st(e),vt()}const mt=l(!1),_t=l(""),ht=l([]),yt=l(!1),bt=l(!1),xt=l(new Map),wt=l(!0),kt=l(null),St=l(null);let Ct=null;const At=i(()=>{const e=me.value;return ht.value.filter(t=>!Te.value.has(Ce(t?.[e]??t?.id)))});async function Mt(){if(ze.value&&wt.value&&!yt.value){yt.value=!0,bt.value=!1;try{me.value;const e=await oe.get(`/items/${ze.value}`,{params:{fields:He.value,limit:-1,search:_t.value||void 0,filter:A.filter||void 0}}),t=e?.data?.data??[];ht.value=t,wt.value=!1}catch{bt.value=!0,wt.value=!1}finally{yt.value=!1}}}function Nt(){Ct&&Ct.disconnect(),Ct=null}function jt(e){mt.value=!!e,mt.value?(xt.value=new Map,ht.value=[],wt.value=!0,bt.value=!1,Mt()):(Nt(),xt.value=new Map)}function Dt(){jt(!1)}function $t(){jt(!0)}function Et(){const e=$e.value,t=new Set(e.map(Ce)),a=[];for(const[e,n]of xt.value.entries())t.has(e)||a.push(n);ot([...e,...a]),jt(!1)}r([mt,kt,St],()=>(Nt(),void(mt.value&&kt.value&&St.value&&(Ct=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&Mt()},{root:kt.value,rootMargin:"300px",threshold:.01}),Ct.observe(St.value)))),{flush:"post"}),s(()=>{Nt()});const Tt=l(!1),Ot=l({}),It=l(!1),Bt=i(()=>Ge()),qt=i(()=>{const e={};return Fe.value&&Bt.value&&"+"!==Bt.value&&(e[Fe.value]=Bt.value),e});function zt(){Ft(!0),Ot.value={}}function Ft(e){Tt.value=!!e,Tt.value?Ot.value={}:(Ot.value={},It.value=!1)}function Ut(){Ft(!1)}async function Vt(){if(ze.value){It.value=!0;try{const e=await oe.post(`/items/${ze.value}`,Ot.value,{params:{fields:[me.value]}}),t=e?.data?.data??null,a=t?.[me.value]??t?.id??null;null!=a&&ot([...$e.value,a]),Ft(!1)}catch{}finally{It.value=!1}}}return(e,t)=>{const a=u("v-button"),n=u("v-icon"),l=u("v-drawer"),i=u("v-form");return c(),d("div",N,[v("div",j,[v("div",D,[f(' <div class="sg__label">Related</div> '),$e.value.length?(c(),d("div",$,p($e.value.length),1)):f("v-if",!0)]),v("div",E,[_(fe)?(c(),m(a,{key:0,secondary:"",disabled:_(ce)||!ze.value,onClick:$t},{default:h(()=>[...t[1]||(t[1]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),g(a,{secondary:"",disabled:_(ce)||$e.value.length<2,onClick:ut},{default:h(()=>[g(n,{name:"shuffle",small:""})]),_:1},8,["disabled"]),_(ve)?(c(),m(a,{key:1,disabled:_(ce)||!ze.value,onClick:zt},{default:h(()=>[...t[2]||(t[2]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])]),qe.value?(c(),d("div",T," Unable to resolve relation metadata for this O2M field. The grid can still render existing values, but “Add Existing” / “Create New” may not work. ")):Be.value?(c(),d("div",O,"Loading relation…")):ze.value?f("v-if",!0):(c(),d("div",I," No related collection detected for this O2M field. ")),Le.value?f("v-if",!0):(c(),d("div",B," This relationship has no manual sort field configured. Drag reordering might not persist server-side until a sort field is set in the relationship settings. ")),v("div",{class:"sg__grid",style:x(Oe.value),onDragover:b(gt,["prevent"]),onDrop:b(pt,["prevent"])},[(c(!0),d(w,null,k(Pe.value,e=>(c(),d("div",{key:Ce(e),class:S(["sg__card",{"sg__card--dragging":dt.value===Ce(e),"sg__card--drag-over":ct.value===Ce(e)}]),draggable:!_(ce),onDragstart:t=>function(e,t){ce.value||(dt.value=Ce(e),ct.value=null,t?.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",dt.value)))}(e,t),onDragend:vt,onDragover:b(t=>function(e){if(!dt.value)return;const t=Ce(e);t!==dt.value&&(ct.value=t)}(e),["prevent"]),onDrop:b(t=>ft(e),["prevent"])},[v("div",z,[lt(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:lt(e),alt:""},null,8,F)):(c(),d("div",U,[g(n,{name:"image"})])),v("div",V,[g(a,{icon:"",small:"",secondary:"",class:"sg__icon-btn",disabled:_(ce),onClick:b(t=>function(e){const t=Ce(e);ot($e.value.filter(e=>Ce(e)!==t))}(e),["stop"])},{default:h(()=>[g(n,{name:"close"})]),_:1},8,["disabled","onClick"]),v("div",L,[g(n,{name:"drag_indicator"})])])]),v("div",G,[v("div",K,p(et(e)),1),v("div",R,p(tt(e)),1)])],42,q))),128)),0===$e.value.length?(c(),d("div",H,[t[5]||(t[5]=v("div",{class:"sg__empty-title"},"No related items",-1)),v("div",J,[_(fe)?(c(),m(a,{key:0,small:"",secondary:"",disabled:_(ce)||!ze.value,onClick:$t},{default:h(()=>[...t[3]||(t[3]=[y(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),_(ve)?(c(),m(a,{key:1,small:"",disabled:_(ce)||!ze.value,onClick:zt},{default:h(()=>[...t[4]||(t[4]=[y(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])])):f("v-if",!0),v("div",{ref_key:"sentinelEl",ref:Xe,class:"sg__sentinel"},null,512)],36),f(" Select Existing "),g(l,{title:"Add Existing","model-value":mt.value,"onUpdate:modelValue":jt,onCancel:Dt},{actions:h(()=>[v("div",le,[f(' <div class="sg__drawer-search">\n\t\t\t\t\t\t<v-input small v-model="selectSearch" placeholder="Search…" @update:modelValue="onSelectSearchChange" />\n\t\t\t\t\t</div> '),g(a,{disabled:0===xt.value.size,onClick:Et},{default:h(()=>[y(" Add "+p(xt.value.size),1)]),_:1},8,["disabled"])])]),default:h(()=>[v("div",{ref_key:"selectGridEl",ref:kt,class:"sg__drawer-grid"},[(c(!0),d(w,null,k(At.value,e=>(c(),d("div",{key:Ce(e[me.value]),class:S(["sg__card sg__card--select",{"sg__card--selected":xt.value.has(Ce(e[me.value]))}]),onClick:t=>function(e){const t=Ce(e),a=new Map(xt.value);a.has(t)?a.delete(t):a.set(t,e),xt.value=a}(e[me.value])},[v("div",Q,[it(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:it(e),alt:""},null,8,W)):(c(),d("div",X,[g(n,{name:"image"})]))]),v("div",Y,[v("div",Z,p(Ae(e,xe.value)??"—"),1),v("div",ee,p(Ae(e,we.value)??""),1)])],10,P))),128)),bt.value?(c(),d("div",te,"Failed to load items.")):yt.value&&0===At.value.length?(c(),d("div",ae,"Loading…")):yt.value||0!==At.value.length?f("v-if",!0):(c(),d("div",ne,"No items available.")),v("div",{ref_key:"selectSentinelEl",ref:St,class:"sg__sentinel"},null,512)],512)]),_:1},8,["model-value"]),f(" Create New "),g(l,{title:"Create New","model-value":Tt.value,"onUpdate:modelValue":Ft,onCancel:Ut},{actions:h(()=>[g(a,{disabled:It.value||!ze.value,onClick:Vt},{default:h(()=>[y(p(It.value?"Creating…":"Create"),1)]),_:1},8,["disabled"])]),default:h(()=>[ze.value?(c(),d("div",re,[g(i,{collection:ze.value,modelValue:Ot.value,"onUpdate:modelValue":t[0]||(t[0]=e=>Ot.value=e),"initial-values":qt.value},null,8,["collection","modelValue","initial-values"])])):(c(),d("div",ie,"No related collection available."))]),_:1},8,["model-value"])])}}};var se=a({id:"sortable-grid",name:"Sortable Grid",icon:"grid_view",description:"Edit a one-to-many relation using a grid of related items.",types:["alias"],localTypes:["o2m"],group:"relational",relational:!0,component:M(oe,[["__scopeId","data-v-325a463a"]]),recommendedDisplays:["related-values"],options:({relations:e,field:{meta:t}})=>{const a=e.o2m?.collection;return[{field:"card_cover",name:"Card Cover",type:"string",meta:{width:"full",interface:"system-field",options:{collectionName:a}}},{field:"card_title",name:"Card Title",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"card_subtitle_key",name:"Card Subtitle",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"columns",name:"Columns",type:"integer",schema:{default_value:6,min:1,max:12},meta:{width:"half",interface:"input"}},{field:"limit",name:"$t:per_page",type:"integer",schema:{default_value:1e3},meta:{width:"half",interface:"input"}},{field:"sort_field",name:"Sort Field",type:"string",meta:{width:"full",interface:"system-field",note:"Optional override. Used when the relationship sort field cannot be detected automatically.",options:{collectionName:a}}}]}});export{se as default};
