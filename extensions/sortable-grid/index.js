import{useApi as e,useStores as t,defineInterface as a}from"@directus/extensions-sdk";import{toRefs as n,ref as l,computed as i,watch as r,onMounted as o,onBeforeUnmount as s,resolveComponent as u,createElementBlock as d,openBlock as c,createElementVNode as v,createCommentVNode as f,createVNode as g,toDisplayString as p,createBlock as m,unref as b,withCtx as _,createTextVNode as h,withModifiers as y,normalizeStyle as x,Fragment as w,renderList as k,normalizeClass as S}from"vue";var C=[],A=[];!function(e,t){if(e&&"undefined"!=typeof document){var a,n=!0===t.prepend?"prepend":"append",l=!0===t.singleTag,i="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(l){var r=C.indexOf(i);-1===r&&(r=C.push(i)-1,A[r]={}),a=A[r]&&A[r][n]?A[r][n]:A[r][n]=o()}else a=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var a=Object.keys(t.attributes),l=0;l<a.length;l++)e.setAttribute(a[l],t.attributes[a[l]]);var r="prepend"===n?"afterbegin":"beforeend";return i.insertAdjacentElement(r,e),e}}("\n.sg[data-v-fcc6bb24] {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 12px;\n}\n.sg__toolbar[data-v-fcc6bb24] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n\tgap: 12px;\n}\n.sg__toolbar-left[data-v-fcc6bb24] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__label[data-v-fcc6bb24] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n}\n.sg__count[data-v-fcc6bb24] {\n\tpadding: 2px 8px;\n\tborder-radius: 999px;\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n}\n.sg__toolbar-right[data-v-fcc6bb24] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n}\n.sg__notice[data-v-fcc6bb24] {\n\tpadding: 10px 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__grid[data-v-fcc6bb24] {\n\tdisplay: grid;\n\tgap: 12px;\n}\n.sg__card[data-v-fcc6bb24] {\n\tborder: 1px solid var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background);\n\tuser-select: none;\n\tcursor: grab;\n}\n.sg__card--select[data-v-fcc6bb24] {\n\tcursor: pointer;\n}\n.sg__card--disabled[data-v-fcc6bb24] {\n\topacity: 0.5;\n\tpointer-events: none;\n}\n.sg__card--selected[data-v-fcc6bb24] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__card--dragging[data-v-fcc6bb24] {\n\topacity: 0.6;\n}\n.sg__card--drag-over[data-v-fcc6bb24] {\n\toutline: 2px solid var(--theme--primary);\n}\n.sg__cover[data-v-fcc6bb24] {\n\tposition: relative;\n\taspect-ratio: 1 / 1;\n\tbackground: var(--theme--background-subdued);\n}\n.sg__cover-img[data-v-fcc6bb24] {\n\tdisplay: block;\n\twidth: 100%;\n\theight: 100%;\n\tobject-fit: cover;\n}\n.sg__cover-placeholder[data-v-fcc6bb24] {\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__card-actions[data-v-fcc6bb24] {\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 6px;\n}\n.sg__drag-handle[data-v-fcc6bb24] {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\twidth: 28px;\n\theight: 28px;\n\tborder-radius: 999px;\n\tbackground: color-mix(in srgb, var(--theme--background) 85%, transparent);\n\tborder: 1px solid var(--theme--border-color);\n\tcolor: var(--theme--foreground-subdued);\n\tcursor: grab;\n}\n.sg__card-body[data-v-fcc6bb24] {\n\tpadding: 10px 12px 12px;\n}\n.sg__title[data-v-fcc6bb24] {\n\tfont-weight: 600;\n\tcolor: var(--theme--foreground);\n\tline-height: 1.2;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.4em;\n}\n.sg__subtitle[data-v-fcc6bb24] {\n\tmargin-top: 4px;\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 12px;\n\tline-height: 1.3;\n\tdisplay: -webkit-box;\n\tline-clamp: 2;\n\t-webkit-line-clamp: 2;\n\t-webkit-box-orient: vertical;\n\toverflow: hidden;\n\tmin-height: 2.6em;\n}\n.sg__sentinel[data-v-fcc6bb24] {\n\theight: 1px;\n}\n.sg__empty[data-v-fcc6bb24] {\n\tgrid-column: 1 / -1;\n\tpadding: 28px 12px;\n\ttext-align: center;\n\tborder: 1px dashed var(--theme--border-color);\n\tborder-radius: var(--theme--border-radius);\n\tcolor: var(--theme--foreground-subdued);\n}\n.sg__empty-title[data-v-fcc6bb24] {\n\tfont-weight: 600;\n\tmargin-bottom: 10px;\n\tcolor: var(--theme--foreground);\n}\n.sg__empty-actions[data-v-fcc6bb24] {\n\tdisplay: inline-flex;\n\tgap: 8px;\n}\n.sg__drawer-grid[data-v-fcc6bb24] {\n\theight: 100%;\n\toverflow: auto;\n\tpadding: 16px;\n\tdisplay: grid;\n\tgap: 12px;\n\tgrid-template-columns: repeat(3, minmax(0, 1fr));\n\talign-content: start;\n    box-sizing: border-box;\n}\n.sg__drawer-form[data-v-fcc6bb24] {\n\theight: 100%;\n\toverflow: auto;\n\tpadding: 16px;\n}\n.sg__drawer-state[data-v-fcc6bb24] {\n\tgrid-column: 1 / -1;\n\tpadding: 12px;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-subdued);\n\tcolor: var(--theme--foreground-subdued);\n\tfont-size: 13px;\n}\n.sg__drawer-actions[data-v-fcc6bb24] {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 8px;\n\tmin-width: 0;\n}\n.sg__drawer-search[data-v-fcc6bb24] {\n\tflex: 1 1 auto;\n\tmin-width: 220px;\n}\n@media (max-width: 600px) {\n.sg__drawer-grid[data-v-fcc6bb24] {\n\t\tgrid-template-columns: repeat(2, minmax(0, 1fr));\n}\n.sg__drawer-search[data-v-fcc6bb24] {\n\t\tmin-width: 0;\n}\n}\n",{});var M=(e,t)=>{const a=e.__vccOpts||e;for(const[e,n]of t)a[e]=n;return a};const N={class:"sg"},T={class:"sg__toolbar"},D={class:"sg__toolbar-left"},j={key:0,class:"sg__count"},$={class:"sg__toolbar-right"},E={key:0,class:"sg__notice"},I={key:1,class:"sg__notice"},O={key:2,class:"sg__notice"},z={key:3,class:"sg__notice"},B=["draggable","onDragstart","onDragover","onDrop"],V={class:"sg__cover"},q=["src"],U={key:1,class:"sg__cover-placeholder"},F={class:"sg__card-actions"},L={class:"sg__drag-handle",title:"Drag to reorder"},G={class:"sg__card-body"},K={class:"sg__title"},R={class:"sg__subtitle"},H={key:0,class:"sg__empty"},J={class:"sg__empty-actions"},P=["onClick"],Q={class:"sg__cover"},W=["src"],X={key:1,class:"sg__cover-placeholder"},Y={class:"sg__card-body"},Z={class:"sg__title"},ee={class:"sg__subtitle"},te={key:0,class:"sg__drawer-state"},ae={key:1,class:"sg__drawer-state"},ne={key:2,class:"sg__drawer-state"},le={class:"sg__drawer-actions"},ie={class:"sg__drawer-search"},re={key:0,class:"sg__drawer-state"},oe={key:1,class:"sg__drawer-form"},se={__name:"interface",props:{value:{type:Array,default:()=>[]},primaryKey:{type:String,default:"id"},collection:{type:String,required:!0},field:{type:String,required:!0},width:{type:String,default:"full"},disabled:{type:Boolean,default:!1},layout:{type:String,default:"grid"},tableSpacing:{type:String,default:"cozy"},version:{type:String,default:"1.0.0"},fields:{type:Array,default:()=>["id"]},template:{type:String,default:null},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0},filter:{type:Object,default:()=>null},enableSearchFilter:{type:Boolean,default:!1},enableLink:{type:Boolean,default:!0},limit:{type:Number,default:1e3},sort:{type:String,default:"id"},sortDirection:{type:String,default:"asc"}},emits:["input"],setup(a,{emit:C}){const A=a,M=C,se=e(),{collection:ue,field:de,primaryKey:ce,disabled:ve,enableCreate:fe,enableSelect:ge}=n(A),{useFieldsStore:pe}=t(),me=pe(),be=l("id"),_e=i(()=>me.getField(ue.value,de.value)?.meta||{}),he=i(()=>_e.value?.options??{});function ye(e){if(!e)return null;if("string"!=typeof e)return null;let t=e.trim();if(!t)return null;const a=t.match(/^\{\{\s*([^}]+?)\s*\}\}$/);return a&&(t=a[1].trim()),t=t.replace(/\s*>\s*/g,"."),t=t.replace(/\s*\.\s*/g,".").replace(/\s+/g,""),t=t.replace(/^\.+/,"").replace(/\.+$/,""),t||null}const xe=i(()=>ye(he.value.card_cover)),we=i(()=>ye(he.value.card_title)),ke=i(()=>ye(he.value.card_subtitle)),Se=i(()=>Number(he.value.columns||6)),Ce=i(()=>Number(he.value.limit||1e3));function Ae(e){return String(e)}function Me(e,t){if(!e||!t)return null;if("string"!=typeof t)return null;const a=t.split(".").filter(Boolean);let n=e;for(const e of a){if(null==n)return null;n=n[e]}return n??null}function Ne(e){return null==e?null:"object"==typeof e?e[be.value]??e.id??null:e}const Te=l(Array.isArray(A.value)?A.value:[]);r(()=>A.value,e=>{Te.value=Array.isArray(e)?e:[]},{deep:!0});const De=i(()=>{const e=Te.value;if(!Array.isArray(e))return[];const t=new Set,a=[];for(const n of e){const e=Ne(n);if(null==e)continue;const l=Ae(e);t.has(l)||(t.add(l),a.push(e))}return a}),je=i(()=>new Set(De.value.map(Ae))),$e=i(()=>({gridTemplateColumns:`repeat(${Math.max(1,Se.value||6)}, minmax(0, 1fr))`})),Ee=l(null),Ie=l(!1),Oe=l(null),ze=i(()=>Ee.value?.collection??null),Be=i(()=>Ee.value?.field??null),Ve=i(()=>Ee.value?.meta?.sort_field??null);r(ze,()=>{!async function(){if(ze.value)try{const e=await se.get(`/fields/${ze.value}`,{params:{limit:-1}}),t=e?.data?.data??[],a=t.find(e=>e?.schema?.is_primary_key)?.field;be.value=a||"id"}catch{be.value="id"}else be.value="id"}()},{immediate:!0}),r([ue,de],()=>{!async function(){Oe.value=null,Ie.value=!0,Ee.value=null;try{const e=await se.get("/relations",{params:{filter:{related_collection:{_eq:ue.value},meta:{one_field:{_eq:de.value}}},limit:1}});Ee.value=e?.data?.data?.[0]??null}catch(e){Oe.value=e,Ee.value=null}finally{Ie.value=!1}}()},{immediate:!0});const qe=l(new Map),Ue=l(new Set);r(()=>Te.value,e=>{if(Array.isArray(e))for(const t of e)if(t&&"object"==typeof t){const e=Ne(t);if(null==e)continue;qe.value.set(Ae(e),t)}},{deep:!0,immediate:!0});const Fe=i(()=>{const e=new Set([be.value]),t=xe.value,a=we.value,n=ke.value;return t&&e.add(t),a&&e.add(a),n&&e.add(n),Array.from(e)}),Le=l(0);r(()=>De.value.length,e=>{0!==Le.value?Le.value=Math.min(Le.value,e):Le.value=Math.min(e,Math.max(1,Ce.value||1e3))},{immediate:!0});const Ge=i(()=>De.value.slice(0,Le.value));async function Ke(){if(!ze.value)return;const e=[];for(const t of Ge.value){const a=Ae(t);qe.value.has(a)||(Ue.value.has(a)||(Ue.value.add(a),e.push(t)))}e.length&&await async function(e){if(!ze.value)return;if(!e.length)return;const t=be.value,a=Fe.value;for(let n=0;n<e.length;n+=100){const l=e.slice(n,n+100);try{const e=await se.get(`/items/${ze.value}`,{params:{fields:a,filter:{[t]:{_in:l}},limit:-1}}),n=e?.data?.data??[];for(const e of n){const a=e?.[t]??e?.id;null!=a&&qe.value.set(Ae(a),e)}}catch{}finally{for(const e of l)Ue.value.delete(Ae(e))}}}(e)}r([Ge,Fe,ze],()=>{Ke()},{immediate:!0});const Re=l(null);let He=null;function Je(e){return qe.value.get(Ae(e))??null}function Pe(e){return(Me(Je(e),we.value)??"—")+""}function Qe(e){const t=Me(Je(e),ke.value);return null==t?"":String(t)}function We(e){return null==e?null:"string"==typeof e||"number"==typeof e?e:"object"==typeof e?e.id??e[be.value]??null:null}function Xe(e){return e?`/assets/${encodeURIComponent(String(e))}?fit=cover&width=600&height=800&quality=80`:null}function Ye(e){const t=Je(e);if(!t||!xe.value)return null;const a=Me(t,xe.value);if(a&&"object"==typeof a&&"string"==typeof a.$thumbnail)return a.$thumbnail;return Xe(We(a))}function Ze(e){if(!e||!xe.value)return null;const t=Me(e,xe.value);if(t&&"object"==typeof t&&"string"==typeof t.$thumbnail)return t.$thumbnail;return Xe(We(t))}o(()=>{He=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&function(){const e=De.value.length;Le.value>=e||(Le.value=Math.min(e,Le.value+Math.max(1,Ce.value||1e3)))}()},{root:null,rootMargin:"300px",threshold:.01}),Re.value&&He.observe(Re.value)}),r(Re,(e,t)=>{He&&(t&&He.unobserve(t),e&&He.observe(e))},{flush:"post"}),s(()=>{He&&He.disconnect()});const et=i(()=>{const e=Te.value;return!(!Array.isArray(e)||0===e.length)&&"object"==typeof e[0]});function tt(e){const t=function(e){if(!et.value)return e;const t=new Map;for(const e of Te.value){const a=Ne(e);null!=a&&t.set(Ae(a),e)}return e.map(e=>t.get(Ae(e))??{[be.value]:e})}(e);Te.value=t,M("input",t)}const at=l(null),nt=l(null);function lt(){at.value=null,nt.value=null}function it(e){if(!at.value)return;const t=Ae(e);t!==at.value&&function(e,t){const a=[...De.value],n=a.findIndex(t=>Ae(t)===e);let l=a.findIndex(e=>Ae(e)===t);if(-1===n||-1===l)return;const[i]=a.splice(n,1);n<l&&(l-=1),a.splice(l,0,i),tt(a)}(at.value,t),lt()}function rt(){}function ot(){if(!at.value)return;const e=[...De.value],t=e.findIndex(e=>Ae(e)===at.value);if(-1===t)return lt();const[a]=e.splice(t,1);e.push(a),tt(e),lt()}const st=l(!1),ut=l(""),dt=l([]),ct=l(!1),vt=l(!1),ft=l(new Map),gt=l(0),pt=l(!0),mt=l(null),bt=l(null);let _t=null;const ht=i(()=>Math.max(1,Math.min(100,Ce.value||50)));function yt(){dt.value=[],gt.value=0,pt.value=!0,vt.value=!1}async function xt(){if(ze.value&&pt.value&&!ct.value){ct.value=!0,vt.value=!1;try{const e=ht.value,t=gt.value,a=be.value,n=await se.get(`/items/${ze.value}`,{params:{fields:Fe.value,limit:e,offset:t,search:ut.value||void 0,filter:A.filter||void 0}}),l=n?.data?.data??[],i=new Set(dt.value.map(e=>Ae(e?.[a]??e?.id))),r=[...dt.value];for(const e of l){const t=Ae(e?.[a]??e?.id);i.has(t)||(i.add(t),r.push(e))}dt.value=r,gt.value+=l.length;const o=n?.data?.meta?.filter_count??n?.data?.meta?.total_count??null;pt.value="number"==typeof o?gt.value<o:l.length===e}catch{vt.value=!0,pt.value=!1}finally{ct.value=!1}}}function wt(){_t&&_t.disconnect(),_t=null}r([st,mt,bt],()=>(wt(),void(st.value&&mt.value&&bt.value&&(_t=new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&xt()},{root:mt.value,rootMargin:"300px",threshold:.01}),_t.observe(bt.value)))),{flush:"post"});let kt=null;function St(){st.value&&(kt&&clearTimeout(kt),kt=setTimeout(()=>{yt(),xt()},250))}function Ct(e){st.value=!!e,st.value?(ft.value=new Map,yt(),xt()):(wt(),ft.value=new Map)}function At(){Ct(!1)}function Mt(){Ct(!0)}function Nt(){const e=De.value,t=new Set(e.map(Ae)),a=[];for(const[e,n]of ft.value.entries())t.has(e)||a.push(n);tt([...e,...a]),Ct(!1)}s(()=>{wt(),kt&&clearTimeout(kt)});const Tt=l(!1),Dt=l({}),jt=l(!1),$t=i(()=>{try{if(null!=ce.value&&"+"!==ce.value&&"id"!==ce.value)return ce.value;const e=(window.location.pathname||"").split("/").filter(Boolean),t=e.indexOf("content");return-1!==t&&e.length>=t+3?e[t+2]:null}catch{return null}}),Et=i(()=>{const e={};return Be.value&&$t.value&&"+"!==$t.value&&(e[Be.value]=$t.value),e});function It(){Ot(!0),Dt.value={}}function Ot(e){Tt.value=!!e,Tt.value?Dt.value={}:(Dt.value={},jt.value=!1)}function zt(){Ot(!1)}async function Bt(){if(ze.value){jt.value=!0;try{const e=await se.post(`/items/${ze.value}`,Dt.value,{params:{fields:[be.value]}}),t=e?.data?.data??null,a=t?.[be.value]??t?.id??null;null!=a&&tt([...De.value,a]),Ot(!1)}catch{}finally{jt.value=!1}}}return(e,t)=>{const a=u("v-button"),n=u("v-icon"),l=u("v-input"),i=u("v-drawer"),r=u("v-form");return c(),d("div",N,[v("div",T,[v("div",D,[t[2]||(t[2]=v("div",{class:"sg__label"},"Related",-1)),De.value.length?(c(),d("div",j,p(De.value.length),1)):f("v-if",!0)]),v("div",$,[b(ge)?(c(),m(a,{key:0,small:"",secondary:"",disabled:b(ve)||!ze.value,onClick:Mt},{default:_(()=>[...t[3]||(t[3]=[h(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),b(fe)?(c(),m(a,{key:1,small:"",disabled:b(ve)||!ze.value,onClick:It},{default:_(()=>[...t[4]||(t[4]=[h(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])]),Oe.value?(c(),d("div",E," Unable to resolve relation metadata for this O2M field. The grid can still render existing values, but “Add Existing” / “Create New” may not work. ")):Ie.value?(c(),d("div",I,"Loading relation…")):ze.value?f("v-if",!0):(c(),d("div",O," No related collection detected for this O2M field. ")),Ve.value?f("v-if",!0):(c(),d("div",z," This relationship has no manual sort field configured. Drag reordering might not persist server-side until a sort field is set in the relationship settings. ")),v("div",{class:"sg__grid",style:x($e.value),onDragover:y(rt,["prevent"]),onDrop:y(ot,["prevent"])},[(c(!0),d(w,null,k(Ge.value,e=>(c(),d("div",{key:Ae(e),class:S(["sg__card",{"sg__card--dragging":at.value===Ae(e),"sg__card--drag-over":nt.value===Ae(e)}]),draggable:!b(ve),onDragstart:t=>function(e,t){ve.value||(at.value=Ae(e),nt.value=null,t?.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",at.value)))}(e,t),onDragend:lt,onDragover:y(t=>function(e){if(!at.value)return;const t=Ae(e);t!==at.value&&(nt.value=t)}(e),["prevent"]),onDrop:y(t=>it(e),["prevent"])},[v("div",V,[Ye(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:Ye(e),alt:""},null,8,q)):(c(),d("div",U,[g(n,{name:"image"})])),v("div",F,[g(a,{icon:"",small:"",secondary:"",class:"sg__icon-btn",disabled:b(ve),onClick:y(t=>function(e){const t=Ae(e);tt(De.value.filter(e=>Ae(e)!==t))}(e),["stop"])},{default:_(()=>[g(n,{name:"close"})]),_:1},8,["disabled","onClick"]),v("div",L,[g(n,{name:"drag_indicator"})])])]),v("div",G,[v("div",K,p(Pe(e)),1),v("div",R,p(Qe(e)),1)])],42,B))),128)),0===De.value.length?(c(),d("div",H,[t[7]||(t[7]=v("div",{class:"sg__empty-title"},"No related items",-1)),v("div",J,[b(ge)?(c(),m(a,{key:0,small:"",secondary:"",disabled:b(ve)||!ze.value,onClick:Mt},{default:_(()=>[...t[5]||(t[5]=[h(" Add Existing ",-1)])]),_:1},8,["disabled"])):f("v-if",!0),b(fe)?(c(),m(a,{key:1,small:"",disabled:b(ve)||!ze.value,onClick:It},{default:_(()=>[...t[6]||(t[6]=[h(" Create New ",-1)])]),_:1},8,["disabled"])):f("v-if",!0)])])):f("v-if",!0),v("div",{ref_key:"sentinelEl",ref:Re,class:"sg__sentinel"},null,512)],36),f(" Select Existing "),g(i,{title:"Add Existing","model-value":st.value,"onUpdate:modelValue":Ct,onCancel:At},{actions:_(()=>[v("div",le,[v("div",ie,[g(l,{modelValue:ut.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>ut.value=e),St],placeholder:"Search…"},null,8,["modelValue"])]),g(a,{disabled:0===ft.value.size,onClick:Nt},{default:_(()=>[h(" Add "+p(ft.value.size),1)]),_:1},8,["disabled"])])]),default:_(()=>[v("div",{ref_key:"selectGridEl",ref:mt,class:"sg__drawer-grid"},[(c(!0),d(w,null,k(dt.value,e=>(c(),d("div",{key:Ae(e[be.value]),class:S(["sg__card sg__card--select",{"sg__card--selected":ft.value.has(Ae(e[be.value])),"sg__card--disabled":je.value.has(Ae(e[be.value]))}]),onClick:t=>function(e){const t=Ae(e);if(je.value.has(t))return;const a=new Map(ft.value);a.has(t)?a.delete(t):a.set(t,e),ft.value=a}(e[be.value])},[v("div",Q,[Ze(e)?(c(),d("img",{key:0,class:"sg__cover-img",src:Ze(e),alt:""},null,8,W)):(c(),d("div",X,[g(n,{name:"image"})]))]),v("div",Y,[v("div",Z,p(Me(e,we.value)??"—"),1),v("div",ee,p(Me(e,ke.value)??""),1)])],10,P))),128)),vt.value?(c(),d("div",te,"Failed to load items.")):ct.value&&0===dt.value.length?(c(),d("div",ae,"Loading…")):ct.value||0!==dt.value.length?f("v-if",!0):(c(),d("div",ne,"No items found.")),v("div",{ref_key:"selectSentinelEl",ref:bt,class:"sg__sentinel"},null,512)],512)]),_:1},8,["model-value"]),f(" Create New "),g(i,{title:"Create New","model-value":Tt.value,"onUpdate:modelValue":Ot,onCancel:zt},{actions:_(()=>[g(a,{disabled:jt.value||!ze.value,onClick:Bt},{default:_(()=>[h(p(jt.value?"Creating…":"Create"),1)]),_:1},8,["disabled"])]),default:_(()=>[ze.value?(c(),d("div",oe,[g(r,{collection:ze.value,modelValue:Dt.value,"onUpdate:modelValue":t[1]||(t[1]=e=>Dt.value=e),"initial-values":Et.value},null,8,["collection","modelValue","initial-values"])])):(c(),d("div",re,"No related collection available."))]),_:1},8,["model-value"])])}}};var ue=a({id:"sortable-grid",name:"Sortable Grid",icon:"grid_view",description:"Edit a one-to-many relation using a grid of related items.",types:["alias"],localTypes:["o2m"],group:"relational",relational:!0,component:M(se,[["__scopeId","data-v-fcc6bb24"]]),recommendedDisplays:["related-values"],options:({relations:e,field:{meta:t}})=>{const a=e.o2m?.collection;return[{field:"card_cover",name:"Card Cover",type:"string",meta:{width:"full",interface:"system-field-tree",options:{collectionName:a}}},{field:"card_title",name:"Card Title",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"card_subtitle",name:"Card Subtitle",type:"string",meta:{width:"half",interface:"system-field-tree",options:{collectionName:a}}},{field:"columns",name:"Columns",type:"integer",schema:{default_value:6,min:1,max:12},meta:{width:"half",interface:"input"}},{field:"limit",name:"$t:per_page",type:"integer",schema:{default_value:1e3},meta:{width:"half",interface:"input"}}]}});export{ue as default};
